(function(){soma={};function c(){}Function.instantiate=function(g,i){c.prototype=g.prototype;var h=new c(),e=g.apply(h,i);return e||h};Function.implement({instantiate:function(e){return Function.instantiate(this,e)}});var b=new Class({dispatchEvent:function(){this.instance.dispatchEvent.apply(this.instance,arguments)},addEventListener:function(){this.instance.addEventListener.apply(this.instance,arguments)},removeEventListener:function(){this.instance.removeEventListener.apply(this.instance,arguments)},hasCommand:function(e){return this.instance.hasCommand(e)},getCommand:function(e){return this.instance.getCommand(e)},getCommands:function(){return this.instance.getCommands()},addCommand:function(f,e){this.instance.controller.addCommand(f,e)},removeCommand:function(e){this.instance.controller.removeCommand(e)},hasWire:function(e){return this.instance.hasWire(e)},getWire:function(e){return this.instance.getWire(e)},addWire:function(f,e){return this.instance.addWire(f,e)},removeWire:function(e){this.instance.removeWire(e)},hasModel:function(e){return this.instance.hasModel(e)},getModel:function(e){return this.instance.getModel(e)},addModel:function(e,f){return this.instance.addModel(e,f)},removeModel:function(e){this.instance.removeModel(e)},getSequencer:function(e){return !!this.instance.controller?this.instance.controller.getSequencer(e):null},stopSequencerWithEvent:function(e){return !!this.instance.controller?this.instance.controller.stopSequencerWithEvent(e):null},stopSequencer:function(e){if(this.instance.controller){return this.instance.controller.stopSequencer(e)}},stopAllSequencers:function(){if(this.instance.controller){this.instance.controller.stopAllSequencers()}},isPartOfASequence:function(e){return !!this.instance.controller?this.instance.controller.isPartOfASequence(e):false},getLastSequencer:function(){return !!this.instance.controller?this.instance.controller.getLastSequencer():null},getRunningSequencers:function(){return !!this.instance.controller?this.instance.controller.getRunningSequencers():null},hasView:function(e){return this.instance.hasView(e)},getView:function(e){return this.instance.getView(e)},addView:function(f,e){return this.instance.addView(f,e)},removeView:function(e){this.instance.removeView(e)}});var d={blackList:["initialize","parent","constructor","$constructor","addEventListener","removeEventListener"],autobind:function(){if(this.wasAutoBound){return}var h=this;var f=h.AutoBindPattern;var g="([lL]istener|[hH]andler|[cB]allback)$";if(!f){f=g}else{f=g+"|"+f}for(var e in h){if(typeof h[e]=="function"){if(this._autobindIsBlacklisted(e)){continue}if(!e.match(f)){continue}h[e]=h[e].bind(h)}}},_autobindIsBlacklisted:function(e){var g=this.blackList;for(var f=0;f<g.length;f++){if(g[f]==e){return true}}return false}};soma.AutoBind=new Class(d);soma.Command=new Class({Implements:b,instance:null,registerInstance:function(e){this.instance=e},execute:function(e){},toString:function(){return"[soma.Command]"}});var a=new Class({event:null,sequenceId:null,initialize:function(e){this.event=e}});soma.SequenceCommand=new Class({Extends:soma.Command,Implements:b,commands:null,currentCommand:null,id:null,initialize:function(e){if(e==null){throw new Error("SequenceCommand Children expect an unique id as constructor arg")}this.commands=[];this.id=e},registerInstance:function(e){this.instance=e;this.initializeSubCommands()},initializeSubCommands:function(){throw new Error("Subclasses of SequenceCommand must implement initializeSubCommands()")},addSubCommand:function(e){var f=new a(e);this.commands.push(f);this.instance.controller.registerSequencedCommand(this,f)},execute:function(e){if(this.commands==null||this.commands.length===0){return}this.currentCommand=this.commands.shift();if(this.hasCommand(this.currentCommand.event.type)){this.dispatchEvent(this.currentCommand.event)}},executeNextCommand:function(){if(this.commands==null){return}this.instance.controller.unregisterSequencedCommand(this,this.currentCommand.event.type);if(this.commands.length>0){this.execute(this.commands[0].event)}else{this.commands=null;this.currentCommand=null}},getLength:function(){if(this.commands==null){return -1}return this.commands.length},stop:function(){this.commands=null;this.commands=null;this.currentCommand=null;return this.instance.controller.unregisterSequencer(this)},getCurrentCommand:function(){return this.currentCommand},getCommands:function(){return this.commands},toString:function(){return"[soma.SequenceCommand]"}});soma.ParallelCommand=new Class({Extends:soma.Command,Implements:b,commands:null,initialize:function(){this.commands=[]},registerInstance:function(e){this.instance=e;this.initializeSubCommands()},initializeSubCommands:function(){throw new Error("Subclasses of ParallelCommand must implement initializeSubCommands()")},addSubCommand:function(f){this.commands.push(f)},execute:function(){while(this.commands.length>0){var e=this.commands.shift();if(this.hasCommand(e.type)){this.dispatchEvent(e)}}this.commands=null},getLength:function(){return this.commands!=null?this.commands.length:-1},getCommands:function(){return this.commands},toString:function(){return"[soma.ParallelCommand]"}});soma.Wire=new Class({Implements:[b,soma.AutoBind],name:null,instance:null,initialize:function(e){if(e!=null){this.name=e}},registerInstance:function(e){this.instance=e},init:function(){},dispose:function(){},getName:function(){return this.name},setName:function(e){this.name=e},toString:function(){return"[soma.Wire]"}});soma.SomaController=(function(){var k=null;var i=null;var e=null;var j=null;var h=null;var f=null;var g=null;return new Class({Implements:soma.IDisposable,instance:null,initialize:function(l){this.instance=l;e={};h={};j={};k=this.instanceHandler.bind(this);i=this.domTreeHandler.bind(this)},addInterceptor:function(l){if(!soma){throw new Error("soma package has been overwritten by local variable")}if(this.instance.body.addEventListener){this.instance.body.addEventListener(l,i,true)}this.instance.addEventListener(l,k,-Number.MAX_VALUE)},removeInterceptor:function(l){if(this.instance.body.removeEventListener){this.instance.body.removeEventListener(l,i,true)}this.instance.removeEventListener(l,k)},executeCommand:function(m){var l=m.type;if(this.hasCommand(l)){var n=soma.createClassInstance(e[l]);n.registerInstance(this.instance);n.execute(m)}},registerSequencedCommand:function(l,n){if(!(n instanceof a)){throw new Error("capsulate sequence commands in SequenceCommandProxy objects!")}var m=h;if(m[l.id]==null||j[l.id]==null){g=l;m[l.id]=[];j[l.id]=l}n.sequenceId=l.id;m[l.id].push(n)},unregisterSequencedCommand:function(m,o){if(typeof o!="string"){throw new Error("Controller::unregisterSequencedCommand() expects commandName to be of type String, given:"+o)}var p=h;if(p[m.id]!=null&&p[m.id]!=undefined){var l=p[m.id].length;for(var n=0;n<l;n++){if(p[m.id][n].event.type==o){p[m.id][n]=null;p[m.id].splice(n,1);if(p[m.id].length==0){p[m.id]=null;delete p[m.id]}break}}}},unregisterSequencer:function(m){var o=j;if(o[m.id]!=null&&o[m.id]!=undefined){o[m.id]=null;delete o[m.id];o=h;if(o[m.id]!=null){var l=o[m.id].length;for(var n=0;n<l;n++){o[m.id][n]=null}o[m.id]=null;delete o[m.id];return true}}return false},hasCommand:function(l){return e[l]!=null},getCommand:function(l){if(this.hasCommand(l)){return e[l]}return null},getCommands:function(){var m=[];var l=e;for(var n in l){m.push(n)}return m},addCommand:function(l,m){if(this.hasCommand(l)){throw new Error("Error in "+this+' Command "'+l+'" already registered.')}e[l]=m;this.addInterceptor(l)},removeCommand:function(l){if(!this.hasCommand(l)){return}e[l]=null;delete e[l];this.removeInterceptor(l)},getSequencer:function(q){var o=h;for(var p in o){var l=o[p].length;for(var n=0;n<l;n++){if(o[p][n]&&o[p][n].event.type===q.type){var m=j[o[p][n].sequenceId];return !!m?m:null}}}return null},stopSequencerWithEvent:function(p){var n=h;for(var o in n){var l=n[o].length;for(var m=0;m<l;m++){if(n[o][m].event.type===p.type){try{j[n[o][m].sequenceId].stop()}catch(q){return false}return true}}}return false},stopSequencer:function(l){if(l==null){return false}l.stop();return true},stopAllSequencers:function(){var m=j;var o=h;for(var n in m){if(o[n]==null){continue}var l=o[n].length;o[n]=null;delete o[n];m[n].stop();m[n]=null;delete m[n]}},isPartOfASequence:function(l){return(this.getSequencer(l)!=null)},getRunningSequencers:function(){var l=[];var m=j;for(var n in m){l.push(m[n])}return l},getLastSequencer:function(){return g},dispose:function(){for(var m in e){this.removeCommand(m)}for(var l in j){j[l]=null;delete j[l]}e=null;j=null;f=null;g=null},domTreeHandler:function(m){if(m.bubbles&&this.hasCommand(m.type)&&!m.isCloned){if(m.stopPropagation){m.stopPropagation()}else{m.cancelBubble=true}var l=m.clone();f=l;this.instance.dispatchEvent(l);if(!l.isDefaultPrevented()){this.executeCommand(m)}f=null}},instanceHandler:function(l){if(l.bubbles&&this.hasCommand(l.type)){if(f!=l){if(!l.isDefaultPrevented()){this.executeCommand(l)}}}f=null}})})();soma.SomaViews=(function(){var e=null;return new Class({Implements:soma.IDisposable,autoBound:false,instance:null,initialize:function(f){e={};this.instance=f},hasView:function(f){return e[f]!=null},addView:function(g,f){if(this.hasView(g)){throw new Error('View "'+g+'" already exists')}if(document.attachEvent){f.instance=this.instance}if(!this.autoBound){soma.View.implement(d);this.autoBound=true}if(f.shouldAutobind){f.autobind()}e[g]=f;if(f.init!=null){f.init()}return f},getView:function(f){if(this.hasView(f)){return e[f]}return null},getViews:function(){var g={};for(var f in e){g[f]=e[f]}return g},removeView:function(f){if(!this.hasView(f)){return}if(e[f]["dispose"]!=null){e[f].dispose()}e[f]=null;delete e[f]},dispose:function(){for(var f in e){this.removeView(f)}e=null;this.instance=null}})})()})();soma.createClassInstance=function(c,e){if(c.$constructor!=Class){c=new Class(new c())}if(arguments.length==1){return new c()}var b=[];for(var d=1;d<arguments.length;d++){b.push(arguments[d])}return c.instantiate(b)};soma.EventDispatcher=new Class({listeners:null,initialize:function(){this.listeners=[]},addEventListener:function(b,c,a){if(!this.listeners||!b||!c){return}if(isNaN(a)){a=0}this.listeners.push({type:b,listener:c,priority:a,scope:this})},removeEventListener:function(c,e){if(!this.listeners||!c||!e){return}var b=0;var a=this.listeners.length;for(b=a-1;b>-1;b--){var d=this.listeners[b];if(d.type==c&&d.listener==e){this.listeners.splice(b,1)}}},hasEventListener:function(c){if(!this.listeners||!c){return false}var b=0;var a=this.listeners.length;for(;b<a;++b){var d=this.listeners[b];if(d.type==c){return true}}return false},dispatchEvent:function(c){if(!this.listeners||!c){return}var b=[];var a;for(a=0;a<this.listeners.length;a++){var d=this.listeners[a];if(d.type==c.type){b.push(d)}}b.sort(function(f,e){return e.priority-f.priority});for(a=0;a<b.length;a++){b[a].listener.apply((c.srcElement)?c.srcElement:c.currentTarget,[c])}},getListeners:function(){return this.listeners.slice()},toString:function(){return"[soma.EventDispatcher]"},dispose:function(){this.listeners=null}});soma.Application=new Class({Extends:soma.EventDispatcher,Implements:soma.IDisposable,body:null,models:null,controller:null,wires:null,views:null,initialize:function(){this.parent();this.body=document.body;if(!this.body){throw new Error("SomaCore requires body of type Element")}this.controller=new soma.SomaController(this);this.models=new soma.SomaModels(this);this.wires=new soma.SomaWires(this);this.views=new soma.SomaViews(this);this.init();this.registerModels();this.registerViews();this.registerCommands();this.registerWires();this.start()},hasCommand:function(a){return(!this.controller)?false:this.controller.hasCommand(a)},getCommand:function(a){return(!this.controller)?null:this.controller.getCommand(a)},getCommands:function(){return(!this.controller)?null:this.controller.getCommands()},addCommand:function(a,b){this.controller.addCommand(a,b)},removeCommand:function(a){this.controller.removeCommand(a)},hasWire:function(a){return(!this.wires)?false:this.wires.hasWire(a)},getWire:function(a){return(!this.wires)?null:this.wires.getWire(a)},getWires:function(){return(!this.wires)?null:this.wires.getWires()},addWire:function(b,a){return this.wires.addWire(b,a)},removeWire:function(a){this.wires.removeWire(a)},hasModel:function(a){return(!this.models)?false:this.models.hasModel(a)},getModel:function(a){return(!this.models)?null:this.models.getModel(a)},getModels:function(){return(!this.models)?null:this.models.getModels()},addModel:function(a,b){return this.models.addModel(a,b)},removeModel:function(a){this.models.removeModel(a)},hasView:function(a){return(!this.views)?false:this.views.hasView(a)},getView:function(a){return(!this.views)?null:this.views.getView(a)},getViews:function(){return(!this.views)?null:this.views.getViews()},addView:function(b,a){return this.views.addView(b,a)},removeView:function(a){this.views.removeView(a)},getSequencer:function(a){return !!this.controller?this.controller.getSequencer(a):null},isPartOfASequence:function(a){return(this.getSequencer(a)!=null)},stopSequencerWithEvent:function(a){return !!this.controller?this.controller.stopSequencerWithEvent(a):false},stopSequencer:function(a){return !!this.controller?this.controller.stopSequencer(a):false},stopAllSequencers:function(){if(this.controller){this.controller.stopAllSequencers()}},getRunningSequencers:function(){return !!this.controller?this.controller.getRunningSequencers():null},getLastSequencer:function(){return !!this.controller?this.controller.getLastSequencer():null},dispose:function(){this.parent();if(this.models){this.models.dispose();this.models=null}if(this.views){this.views.dispose();this.views=null}if(this.controller){this.controller.dispose();this.controller=null}if(this.wires){this.wires.dispose();this.wires=null}if(this.mediators){this.mediators.dispose();this.mediators=null}this.body=null},toString:function(){return"[soma.Application]"},init:function(){},registerModels:function(){},registerViews:function(){},registerCommands:function(){},registerWires:function(){},start:function(){}});soma.SomaModels=(function(){var a=null;return new Class({Implements:soma.IDisposable,instance:null,initialize:function(b){this.instance=b;a={}},hasModel:function(b){return a[b]!=null},getModel:function(b){if(this.hasModel(b)){return a[b]}return null},getModels:function(){var d={};var c=a;for(var b in c){d[b]=c[b]}return d},addModel:function(b,c){if(this.hasModel(b)){throw new Error('Model "'+b+'" already exists')}a[b]=c;if(!c.dispatcher){c.dispatcher=this.instance}c.init();return c},removeModel:function(b){if(!this.hasModel(b)){return}a[b].dispose();a[b]=null;delete a[b]},dispose:function(){for(var b in this.models){this.removeModel(b)}a=null;this.instance=null}})})();soma.Model=new Class({name:null,data:null,dispatcher:null,initialize:function(a,c,b){this.data=c;this.dispatcher=b;if(a!=null){this.name=a}},init:function(){},dispose:function(){},dispatchEvent:function(){if(this.dispatcher){this.dispatcher.dispatchEvent.apply(this.dispatcher,arguments)}},addEventListener:function(){if(this.dispatcher){this.dispatcher.addEventListener.apply(this.dispatcher,arguments)}},removeEventListener:function(){if(this.dispatcher){this.dispatcher.addEventListener.apply(this.dispatcher,arguments)}},getName:function(){return this.name},setName:function(a){this.name=a},toString:function(){return"[soma.Model]"}});soma.View=new Class({instance:null,domElement:null,initialize:function(b){var a;if(b!=undefined){if(b.nodeType){a=b}else{throw new Error("domElement has to be a DOM-ELement")}}else{a=document.body}this.domElement=a},dispatchEvent:function(a){if(this.domElement.dispatchEvent){this.domElement.dispatchEvent(a)}else{if(this.instance){this.instance.dispatchEvent(a)}}},addEventListener:function(){if(this.domElement.addEventListener){this.domElement.addEventListener.apply(this.domElement,arguments)}else{if(this.instance){this.instance.addEventListener.apply(this.instance,arguments)}}},removeEventListener:function(){if(this.domElement.addEventListener){this.domElement.removeEventListener.apply(this.domElement,arguments)}else{if(this.instance){this.instance.removeEventListener.apply(this.instance,arguments)}}},init:function(){},dispose:function(){},toString:function(){return"[soma.View]"}});soma.SomaWires=(function(){var a=null;return new Class({Implements:soma.IDisposable,instance:null,initialize:function(b){this.instance=b;a={}},hasWire:function(b){return a[b]!=null},addWire:function(c,b){if(this.hasWire(c)){throw new Error('Wire "'+c+'" already exists')}if(b.shouldAutobind){b.autobind()}a[c]=b;b.registerInstance(this.instance);b.init();return b},getWire:function(b){if(this.hasWire(b)){return a[b]}return null},getWires:function(){var c={};for(var b in a){c[b]=a[b]}return c},removeWire:function(b){if(!this.hasWire(b)){return}a[b].dispose();a[b]=null;delete a[b]},dispose:function(){for(var b in a){this.removeWire(b)}a=null;this.instance=null}})})();soma.Mediator=new Class({Extends:soma.Wire,Implements:soma.IDisposable,viewComponent:null,initialize:function(a){this.viewComponent=a;this.parent()},dispose:function(){this.viewComponent=null;this.parent()},toString:function(){return"[soma.Mediator]"}});soma.Event=new Class({initialize:function(c,f,b,a){var d=soma.Event.createGenericEvent(c,b,a);if(f!=null&&f!=undefined){d.params=f}d.isCloned=false;d.clone=this.clone.bind(d);d.isIE9=this.isIE9;d.isDefaultPrevented=this.isDefaultPrevented;if(this.isIE9()||!d.preventDefault||(d.getDefaultPrevented==undefined&&d.defaultPrevented==undefined)){d.preventDefault=this.preventDefault.bind(d)}if(this.isIE9()){d.IE9PreventDefault=false}return d},clone:function(){var a=soma.Event.createGenericEvent(this.type,this.bubbles,this.cancelable);a.params=this.params;a.isCloned=true;a.clone=this.clone;a.isDefaultPrevented=this.isDefaultPrevented;a.isIE9=this.isIE9;if(this.isIE9()){a.IE9PreventDefault=this.IE9PreventDefault}return a},preventDefault:function(){if(!this.cancelable){return false}this.defaultPrevented=true;if(this.isIE9()){this.IE9PreventDefault=true}this.returnValue=false;return this},isDefaultPrevented:function(){if(!this.cancelable){return false}if(this.isIE9()){return this.IE9PreventDefault}if(this.defaultPrevented!=undefined){return this.defaultPrevented}else{if(this.getDefaultPrevented!=undefined){return this.getDefaultPrevented()}}return false},isIE9:function(){return document.body.style.scrollbar3dLightColor!=undefined&&document.body.style.opacity!=undefined},toString:function(){return"[soma.Event]"}});soma.Event.createGenericEvent=function(c,b,a){var d;b=b!==undefined?b:true;if(document.createEvent){d=document.createEvent("Event");d.initEvent(c,b,!!a)}else{d=document.createEventObject();d.type=c;d.bubbles=!!b;d.cancelable=!!a}return d};soma.IResponder=new Class({fault:function(a){},result:function(a){}});soma.IDisposable=new Class({dispose:function(){}});