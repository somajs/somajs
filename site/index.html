<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!-- Consider adding a manifest.appcache: h5bp.com/d/Offline -->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<title>soma-template by soundstep</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
	<meta name="description" content="soma.js is a javascript scalable framework that is meant to help developers to write loosely-coupled applications to increase scalability and maintainability.">
	<meta name="keywords" content="soma soma.js js javascript framework mvc somacore soundstep design pattern events tools toolset html css ria mobile desktop prototype loose-coupling model view controller native development">
	<link rel="icon" type="image/png" href="favicon.png">
	<link rel="stylesheet" href="assets/gh-buttons/gh-buttons.css">
	<link rel="stylesheet" href="assets/styles/pygment/native.css">
	<link rel="stylesheet" href="assets/styles/styles.css">
	<script src="assets/js/libs/respond.js"></script>
	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<link rel="shortcut icon" href="../assets/common/images/favicon.ico">
	<link rel="apple-touch-icon" href="../assets/common/images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="../assets/common/images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="../assets/common/images/apple-touch-icon-114x114.png">

	<script type="text/javascript">

		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-36294101-3']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();

	</script>

</head>
<body>

<div class="wrapper">
	<header>
		<h1><a href="./">soma.js</a></h1>

		<p>Scalable javascript framework</p>

		<ul>
			<li><a href="https://github.com/somajs/somajs/zipball/master">Download <strong>ZIP File</strong></a></li>
			<li><a href="https://github.com/somajs/somajs/tarball/master">Download <strong>TAR Ball</strong></a></li>
			<li><a href="https://github.com/somajs/somajs">View On <strong>GitHub</strong></a></li>
		</ul>

	</header>

	<div id="navigation">
		<nav>
			<ul>
				<li><a href="#what-is-soma-js">What is soma.js?</a></li>
				<li><a href="#download">Download</a></li>
				<li><a href="#quick-start">Quick start</a></li>
				<li><a href="#application-instance">Application instance</a></li>
				<li><a href="#core-elements">Core elements</a></li>
				<li>
					<p><a href="#dependency-injection">Dependency injection</a><p>
					<ul class="hidden">
						<li><a href="#what-is-dependency-injection">What is dependency injection?</a></li>
						<li><a href="#using-dependency-injection-in-somajs">Using dependency injection in soma.js</a></li>
						<li><a href="https://github.com/soundstep/infuse.js" target="_blank">infuse.js</a></li>
					</ul>
				</li>
				<li><p><a href="#communication">Communication</a></p>
					<ul class="hidden">
						<li><a href="#native-event-system">Native event system</a></li>
						<li><a href="#creating-and-dispatching-events">Creating and dispatching events</a></li>
						<li><a href="#listening-to-events">Listening to events</a></li>
						<li><a href="#send-parameters">Send parameters</a></li>
						<li><a href="https://github.com/soundstep/soma-events" target="_blank">soma-events</a></li>
					</ul>
				</li>
				<li><p><a href="#command">Command</a></p>
					<ul class="hidden">
						<li><a href="#create-commands">Create commands</a></li>
						<li><a href="#manage-commands">Manage commands</a></li>
						<li><a href="#simple-command-example">Simple command example</a></li>
						<li><a href="#flow-control">Flow control</a></li>
					</ul>
				</li>
				<li><p><a href="#mediator">Mediator</a></p>
					<ul class="hidden">
						<li><a href="#create-mediators">Create mediators</a></li>
						<li><a href="#simple-mediator-example">Simple mediator example</a></li>
						<li><a href="#decoupling-communication">Decoupling communication</a></li>
					</ul>
				</li>
				<li><p><a href="#template">Template</a></p>
					<ul class="hidden">
						<li><a href="#load-template-plugin">Load the template plugin</a></li>
						<li><a href="#create-a-template">Create a template</a></li>
						<li><a href="#simple-template-example">Simple template example</a></li>
						<li><a href="http://soundstep.github.io/soma-template/" target="_blank">soma-template</a></li>
					</ul>
				</li>
				<li><p><a href="#oop">OOP</a></p>
					<ul class="hidden">
						<li><a href="#inheritance">Inheritance</a></li>
						<li><a href="#extend-method-shortcut">Extend method shortcut</a></li>
						<li><a href="#call-super-constructor-and-methods">Call super constructors and methods</a></li>
					</ul>
				</li>
				<li><p><a href="#plugins">Plugins</a></p>
					<ul class="hidden">
						<li><a href="#create-a-plugin">Create a plugin</a></li>
						<li><a href="#mouse-plugin">Mouse plugin</a></li>
						<li><a href="#ready-plugin">Ready plugin (auto-regitration)</a></li>
						<li><a href="#orientation-plugin">Orientation plugin</a></li>
					</ul>
				</li>
				<li><a href="#router">Router</a></li>
				<li><a href="#demos">Demos</a></li>
				<li><a href="#tools">Tools</a></li>
				<li><a href="#tests">Tests</a></li>
				<li><a href="https://groups.google.com/forum/#!forum/somajs" target="_blank">Questions</a></li>
				<li><a href="#browser-support">Browser support</a></li>
		</nav>
		<footer>
			<p>
				<a href="https://twitter.com/soundstep" target="_blank">@soundstep</a><br/>
				<a href="http://www.soundstep.com" target="_blank">www.soundstep.com</a>
			</p>

			<p>
				<small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a>
				</small>
			</p>
		</footer>
	</div>

	<section>

		<div class="title">
			<h1>What is soma.js?</h1>
			<a class="anchor" name="what-is-soma-js"></a>
		</div>

		<p>soma.js is a framework created to build scalable and maintainable javascript applications.</p>

		<p>The success to build large-scale applications will rely on smaller single-purposed parts of a larger system. soma.js provides tools to create a <a href="http://en.wikipedia.org/wiki/Loose_coupling" target="_blank">loosely-coupled</a> architecture broken down into smaller pieces.</p>
		<p>The different components of an application can be modules, models, views, plugins or widgets. soma.js will not dictate its own structure, the framework can be used as a <a href="http://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller" target="_blank">model-view-controller</a> framework, can be used to create independent modules, sandboxed widgets or anything that will fit a specific need.</p>
		<p>For a system to grow and be maintainable, its parts must have a very limited knowledge of their surrounding. The components must not be tied to each other (<a href="http://en.wikipedia.org/wiki/Law_of_Demeter" target="_blank">Law of Demeter</a>), in order to be re-usable, interchangeable and allow the system to scale up.</p>
		<p>soma.js is a set of tools and design patterns to build a long term architecture that are decoupled and easily testable. The tools provided by the framework are <a href="http://en.wikipedia.org/wiki/Dependency_injection" target="_blank">dependency injection</a>, <a href="http://en.wikipedia.org/wiki/Observer_pattern" target="_blank">observer pattern</a>, <a href="http://en.wikipedia.org/wiki/Mediator_pattern" target="_blank">mediator pattern</a>, <a href="http://en.wikipedia.org/wiki/Facade_pattern" target="_blank">facade pattern</a>, <a href="http://en.wikipedia.org/wiki/Command_pattern" target="_blank">command pattern</a>, <a href="http://en.wikipedia.org/wiki/Object-oriented_programming" target="_blank">OOP</a> utilities and a DOM manipulation template engine as an optional plugin.</p>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Download</h1>
			<a class="anchor" name="download"></a>
		</div>

		<h3>Browser</h3>
		<p><a href="https://github.com/somajs/somajs/tree/master/build" class="button icon tag" target="_blank">download soma.js</a></p>
		<p>You can also download a <a href="https://github.com/somajs/somajs/zipball/master">zip file</a> containing everything. Finally, add the script to your page:</p>
		<div class="highlight"><pre><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;soma.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span></pre></div>
		<h3>Node.js</h3>
		<div class="highlight"><pre><span class="nx">$</span> <span class="nx">npm</span> <span class="nx">install</span> <span class="nx">soma.js</span></pre></div>
		<div class="highlight"><pre><span class="kd">var</span> <span class="nx">soma</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;soma.js&quot;</span><span class="p">);</span></pre></div>
		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Quick start</h1>
			<a class="anchor" name="quick-start"></a>
		</div>

		<p>Here is an example of what a soma.js application could look like. In this case, following the MVC pattern.</p>
		<p>The application contains a model that holds data, a template that manipulate a DOM element and an application instance that hook them up. The application instance must extend a framework function (<code>soma.Application</code>), while the other entities (model and template) are plain javascript function free of framework code.</p>
		<p>The template function receives a template instance, a DOM element and the model, using dependency injection.</p>

		<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;app&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h1&gt;</span><span class="cp">{{</span><span class="nv">content</span><span class="cp">}}</span><span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;script&gt;</span>

  <span class="c1">// function model containing data (text to display)</span>
  <span class="kd">var</span> <span class="nx">Model</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="s2">&quot;Hello world!&quot;</span>
  <span class="p">};</span>

  <span class="c1">// function template that will update the DOM</span>
  <span class="kd">var</span> <span class="nx">Template</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">template</span><span class="p">,</span> <span class="nx">scope</span><span class="p">,</span> <span class="nx">element</span><span class="p">,</span> <span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">scope</span><span class="p">.</span><span class="nx">content</span> <span class="o">=</span> <span class="nx">model</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
    <span class="nx">template</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
  <span class="p">};</span>

  <span class="c1">// application function</span>
  <span class="kd">var</span> <span class="nx">QuickStartApplication</span> <span class="o">=</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// model mapping rule so it can be injected in the template</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">.</span><span class="nx">mapClass</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="nx">Model</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
      <span class="c1">// create a template for a specific DOM element</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">createTemplate</span><span class="p">(</span><span class="nx">Template</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;.app&#39;</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="c1">// create application</span>
  <span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">QuickStartApplication</span><span class="p">();</span>

<span class="nt">&lt;/script&gt;</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/UqqsbcqHZGM9aWzgPV50?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Application instance</h1>
			<a class="anchor" name="application-instance"></a>
		</div>

		<p>The first step to build a soma.js application is to create an application instance. This is the only moment a framework function has to be extended, all the other entities can be re-usable plain javascript function, and framework agnostic.</p>
		<p>The application instance will execute two functions so you can setup the architecture needed: the init and the start functions.</p>
		<p>Here are different syntax to create an application instance.</p>

		<div class="highlight"><pre><span class="kd">var</span> <span class="nx">MyApplication</span> <span class="o">=</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;init&#39;</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyApplication</span><span class="p">();</span>
</pre></div>

		<div class="highlight"><pre><span class="kd">var</span> <span class="nx">MyApplication</span> <span class="o">=</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">extend</span><span class="p">();</span>

<span class="nx">MyApplication</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;init&#39;</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">MyApplication</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">start</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyApplication</span><span class="p">();</span>
</pre></div>

		<div class="highlight"><pre><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Application</span><span class="p">();</span></pre></div>

		<p>The constructor of an application can be overridden to implement your own. The "parent" constructor will have to be called so the framework can bootstrap. Click here to <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Function/call" target="_blank">learn more about chaining constructor</a>.</p>

		<div class="highlight"><pre><span class="kd">var</span> <span class="nx">MyApplication</span> <span class="o">=</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">constructor</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">param</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">param</span> <span class="o">=</span> <span class="nx">param</span><span class="p">;</span>
    <span class="nx">soma</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;init with param:&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">param</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyApplication</span><span class="p">(</span><span class="s2">&quot;my application parameter&quot;</span><span class="p">);</span>
</pre></div>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Core elements</h1>
			<a class="anchor" name="core-elements"></a>
		</div>

		<p>The framework core elements to help you build your own structure are the following:</p>
		<ul>
			<li>Dependency injection (<code>injector</code> property)</li>
			<li>Observer pattern (<code>dispatcher</code> property)</li>
			<li>Command pattern (<code>commands</code> property)</li>
			<li>Mediator pattern (<code>mediators</code> property)</li>
			<li>Facade pattern (<code>instance</code> property)</li>
		</ul>
		<p>They are available in the application or in other entities using dependency injection.</p>
		<p>Here is how to get their references in the application instance.</p>

		<div class="highlight"><pre><span class="kd">var</span> <span class="nx">MyApplication</span> <span class="o">=</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">;</span> <span class="c1">// dependency injection pattern</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">dispatcher</span><span class="p">;</span> <span class="c1">// observer pattern</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">commands</span><span class="p">;</span> <span class="c1">// command pattern</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">mediators</span><span class="p">;</span> <span class="c1">// mediator pattern</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">instance</span><span class="p">;</span> <span class="c1">// facade pattern</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>

		<p>Here are two different syntax to get their references in other entities. The injector will either send the core elements in the constructor or set the corresponding properties.</p>

		<div class="highlight"><pre><span class="kd">var</span> <span class="nx">Entity</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">injector</span><span class="p">,</span> <span class="nx">dispatcher</span><span class="p">,</span> <span class="nx">commands</span><span class="p">,</span> <span class="nx">mediators,</span> <span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>

<span class="p">};</span>
</pre></div>

		<div class="highlight"><pre><span class="kd">var</span> <span class="nx">Entity</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">injector</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">dispatcher</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">commands</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">mediators</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">instance</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>

		<p>Note: in case of injected variables (versus constructor parameters), it is necessary to set properties to a value (such as null), <code>undefined</code> properties are ignored by the injector.</p>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Dependency injection</h1>
			<a class="anchor" name="dependency-injection"></a>
		</div>

		<p><a href="https://github.com/soundstep/infuse.js" target="_blank">infuse.js</a> is the dependency injection library developed for soma.js, <a href="https://github.com/soundstep/infuse.js" target="_blank">click here to see the infuse.js documentation and tests</a>.</p>

		<div class="subtitle">
			<h2>What is dependency injection?</h2>
			<a class="anchor" name="what-is-dependency-injection"></a>
		</div>

		<p><a href="http://en.wikipedia.org/wiki/Dependency_injection" target="_blank">Dependency injection</a> (DI) and <a href="http://en.wikipedia.org/wiki/Inversion_of_control" target="_blank">inversion of control</a> (IOC) are two terms often used in programming. Before explaining the benefits of dependency injection and how it is implemented in soma.js, here is a naive and hopefully accessible explanation.</p>

		<p>A dependency is the relationships between two objects. This relationship is often characterized by side effects that can be problematic and undesirable at times.</p>
		<p>Dependency injection is the process in which you are setting up rules that determine how dependencies are injected into an object automatically, as opposed to have hard-coded dependencies.</p>
		<p>An object "A" that needs an object "B" to work has a direct dependency to it. Code where the components are dependent on nearly everything else is a "highly-coupled code". The result is an application that is hard to maintain, with components that are hard to change without impacting on others.</p>
		<p>Dependency injection is an antidote for highly-coupled code. The cost required to wire objects together falls to next to zero.</p>
		<p>Dependency Injection is based on the following assumptions:</p>
		<ul>
			<li>Tight coupling of object implementations is always bad.Â </li>
			<li>A dependent function is never a good place to create a dependency.</li>
		</ul>
		<p>Consider the process of using the dependency injection pattern as centralizing knowledge of all dependencies and their implementations.</p>
		<p>A common dependency injection system has a separate object (an injector, often called container), that will instantiate new objects and populate them with what they needs: the dependencies. Dependency injection is a useful pattern to solve nested dependencies, as they can chain and be nested through several layers of the application.</p>
		<p>The benefits of dependency injection are:</p>
		<ul>
			<li>More re-usable components.</li>
			<li>Improved code maintenance.</li>
			<li>More testable components (mocking object).</li>
			<li>More readable code (reduction of boilerplate code).</li>
		</ul>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Using dependency injection in soma.js</h2>
			<a class="anchor" name="using-dependency-injection-in-somajs"></a>
		</div>

		<p>Dependency injection involves a way of thinking called the <a href="http://en.wikipedia.org/wiki/Hollywood_principle" target="_blank">Hollywood principle</a> "don't call us, we'll call you". This is exactly how it works in soma.js. Entities will ask for their dependencies using properties and/or constructor parameters.</p>
		<p>Using dependency injection implies creating rules, so the injector knows "what" and "how" to populate the dependencies.</p>
		<p>These are called "mapping rules". A rule is simply "mapping" a name (string) to an "object" (string, number, boolean, function, object, and so on). These mapping names are used to inject the corresponding objects in either a javascript constructor or a variable.</p>

		<div>
			<h4>A simple example</h4>
		</div>

		<p>In the following example, two plain javascript functions will be instantiated and injected.</p>
		<ul>
			<li>The <code>Config</code> function has a <code>debugMode</code> constructor parameter that happened to be an injection name (mapping rule associated), the corresponding boolean value will be injected into it.</li>
			<li>The <code>Model</code> function contains two constructor parameters that also are injection names. A config instance and a boolean value will be injected into the corresponding parameters.</li>
			<li>Two mapping rules are defined, one using the <code>mapClass</code> method used to map functions and one using the <code>mapValue</code> method used to map objects that are not meant to be instantiated.</li>
			<li>In the last line, the Model instance is instantiated by the injector, which will take care of all the dependencies and nested dependencies needed.</li>
		</ul>

		<div class="highlight"><pre><span class="c1">// simple function that will be injected into the model</span>
<span class="c1">// a boolean dependency is injected</span>
<span class="kd">var</span> <span class="nx">Config</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">debugMode</span><span class="p">)</span> <span class="p">{</span>

<span class="p">};</span>
<span class="c1">// simple function in which a config instance and a boolean is injected</span>
<span class="kd">var</span> <span class="nx">Model</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="nx">debugMode</span><span class="p">)</span> <span class="p">{</span>

<span class="p">};</span>
<span class="c1">// mapping rule: map the string &quot;config&quot; to the function Config</span>
<span class="nx">injector</span><span class="p">.</span><span class="nx">mapClass</span><span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="nx">Config</span><span class="p">);</span>
<span class="c1">// mapping rule: map the string &quot;debugMode&quot; to a boolean</span>
<span class="nx">injector</span><span class="p">.</span><span class="nx">mapValue</span><span class="p">(</span><span class="s2">&quot;debugMode&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="c1">// instantiate the model using the injector</span>
<span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="nx">injector</span><span class="p">.</span><span class="nx">createInstance</span><span class="p">(</span><span class="nx">Model</span><span class="p">);</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/C7m5qE7hYpUnQK6a9rNp?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div>
			<h4>Singleton injection</h4>
		</div>

		<p>By default, every single time the injector will find a dependency that needs to be instantiated (such as the <code>Config</code> function in the previous example), the injector will instantiate a new one. A third parameter can be used when defining the <code>mapClass</code> rule: the "singleton" parameter.</p>
		<p>The effect will be that the injector will instantiate the function the first time it is asked, and send that same instance when it is asked again. This is useful to share an instance with several other components.</p>

		<div class="highlight"><pre><span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">.</span><span class="nx">mapClass</span><span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="nx">Config</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span></pre></div>

		<p><a href="http://plnkr.co/edit/ZLv66EglhbBGyieujxG3?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div>
			<h4>Where can injection be used?</h4>
		</div>

		<p>Injection can be used in any function instantiated by the injector:</p>
		<ul>
			<li>Entities manually created using the injector</li>
			<li>Dependencies of entities as they are automatically created by the injector</li>
			<li>Commands as they are internally created by the injector</li>
			<li>Mediators as they are internally created by the injector</li>
			<li>Templates as they are internally created by the injector</li>
		</ul>

		<p>In the following example, dispatching an event will instantiate and execute a <code>Command</code> function, which will instantiate a <code>Model</code> function as it needs this dependency, which will instantiate a <code>Config</code> function as it needs this dependency.</p>

		<div class="highlight"><pre><span class="kd">var</span> <span class="nx">Config</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Config instantiated&quot;</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">Model</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Model instantiated with a config injected:&quot;</span><span class="p">,</span> <span class="nx">config</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">Command</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">execute</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Command executed with a model injected:&quot;</span><span class="p">,</span> <span class="nx">model</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// mapping rule: map the string &quot;config&quot; to the function Config</span>
<span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">.</span><span class="nx">mapClass</span><span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="nx">Config</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="c1">// mapping rule: map the string &quot;model&quot; to the function Model</span>
<span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">.</span><span class="nx">mapClass</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="nx">Model</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="c1">// command mapped to an event</span>
<span class="k">this</span><span class="p">.</span><span class="nx">commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;some-event&quot;</span><span class="p">,</span> <span class="nx">Command</span><span class="p">);</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/jN2OzC3wbcmzvHJ1XgDP?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Communication</h1>
			<a class="anchor" name="communication"></a>
		</div>

		<p><a href="https://github.com/soundstep/soma-events" target="_blank">soma-events</a> is the observer library developed for soma.js, <a href="https://github.com/soundstep/soma-events" target="_blank">click here to see the soma-events documentation and tests</a>.</p>

		<div class="subtitle">
			<h2>Native event system</h2>
			<a class="anchor" name="native-event-system"></a>
		</div>

		<p>Communicating between entities in an application is an important part. Object orientated programming is all about states of objects and their interaction. Certain objects need to be informed about changes in others objects, some others need to inform the rest of the application and some others will do both.</p>
		<p>The <a href="http://en.wikipedia.org/wiki/Observer_pattern" target="_blank">Observer pattern</a> is a design pattern used to communicate between objects and reduce the dependencies. One the core elements of soma.js is the "dispatcher", an event system used to dispatch and listen to events throughout the entire application.</p>
		<p>For example, a model component that receives data can use the dispatcher to notify the rest of the application that the data has changed. A view component can use the dispatcher to inform other components that a user input has just happened.</p>
		<p>The library used to dispatch and listen to events (<a href="https://github.com/soundstep/soma-events" target="_blank">soma-events</a>) is not a simple publish-subscribe library. In case of an application related to the DOM (in opposition to a node.js application), the events used are real <a href="http://www.w3.org/TR/DOM-Level-3-Events/" target="_blank">DOM events</a>, and the dispatcher shares a common interface to DOM 3 events. The result is that the soma.js dispatcher can be interchanged with a DOM Element for a complete application decoupling.</p>
		<p>The <a href="https://github.com/soundstep/soma-events" target="_blank">soma-events</a> library provides a custom dispatcher (usable in non-DOM environment), a event wrapper that will create the right events depending on the environment (webkit, internet explorer, non-DOM environment), and some shortcuts for ease-of-use.</p>
		<p>Note: the shortcuts are not part of the DOM 3 events specification.</p>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Creating and dispatching events</h2>
			<a class="anchor" name="creating-and-dispatching-events"></a>
		</div>

		<p>To dispatch an event, the first step is to create it. There are four ways to create events:</p>
		<ul>
			<li>Using a <code>dispatch</code> method shortcut</li>
			<li>Instantiating the event wrapper</li>
			<li>Extending the event wrapper and instantiating the custom event</li>
			<li>Creating real DOM events</li>
		</ul>

		<div class="back"><a href="#">top</a></div>

		<div>
			<h4>Create and dispatch an event using the dispatcher shortcut</h4>
		</div>

		<p>Creating an event and dispatching it with the dispatcher shortcut is the easiest way. Note that the shortcut syntax is not part of the DOM 3 specification if it matters for the application.</p>

		<div class="highlight"><pre><span class="nx">dispatcher</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s2">&quot;some-event&quot;</span><span class="p">);</span>
<span class="nx">dispatcher</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s2">&quot;another-event&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">data</span><span class="o">:</span><span class="s2">&quot;parameters&quot;</span><span class="p">});</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/ypcBB9hJEZt7UdSvVujr?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div>
			<h4>Create and dispatch an event instantiating the event wrapper</h4>
		</div>

		<p>An instance of the event wrapper can be created, and dispatched following the DOM 3 dispatchEvent interface.</p>

		<div class="highlight"><pre><span class="nx">dispatcher</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="k">new</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s1">&#39;some-event&#39;</span><span class="p">));</span>
<span class="nx">dispatcher</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="k">new</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s1">&#39;some-event&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">data</span><span class="o">:</span><span class="s2">&quot;parameters&quot;</span><span class="p">}));</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/eRFQuQVQRxAEGLh784a4?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div>
			<h4>Create and dispatch an event instantiating an extended event wrapper</h4>
		</div>

		<p>The event wrapper can also be extended to specify custom variables or change the implementation.</p>

		<div class="highlight"><pre><span class="kd">var</span> <span class="nx">MyEvent</span> <span class="o">=</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">constructor</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span> <span class="nx">bubbles</span><span class="p">,</span> <span class="nx">cancelable</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span> <span class="nx">bubbles</span><span class="p">,</span> <span class="nx">cancelable</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="nx">dispatcher</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="k">new</span> <span class="nx">MyEvent</span><span class="p">(</span><span class="s1">&#39;some-event&#39;</span><span class="p">));</span>
<span class="nx">dispatcher</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="k">new</span> <span class="nx">MyEvent</span><span class="p">(</span><span class="s1">&#39;some-event&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">data</span><span class="o">:</span><span class="s2">&quot;parameters&quot;</span><span class="p">}));</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/f4pKAQ0YR3GWkTjYRJhk?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div>
			<h4>Create and dispatch an event using DOM Native methods</h4>
		</div>

		<p>In case an entity requires a very strict decoupling, the dispatcher can be switch to a DOM Element (see the <a href="https://github.com/soundstep/soma-events" target="_blank">soma-event documentation</a>), and a DOM Event can be used rather than using the event wrapper.</p>
		<p>The goal of the event wrapper is hiding the complexity of creating cross-browser events, solving cross-browser different implementations and creating objects that represents events for node.js. The following example will only work in browsers that support the "document.createEvent" method.</p>

		<div class="highlight"><pre><span class="c1">// swap the dispatcher to a DOM Element (window in this example)</span>
<span class="nx">injector</span><span class="p">.</span><span class="nx">removeMapping</span><span class="p">(</span><span class="s2">&quot;dispatcher&quot;</span><span class="p">);</span>
<span class="nx">injector</span><span class="p">.</span><span class="nx">mapValue</span><span class="p">(</span><span class="s2">&quot;dispatcher&quot;</span><span class="p">,</span> <span class="nb">window</span><span class="p">);</span>
<span class="c1">// listen to an event</span>
<span class="nx">dispatcher</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;some-event&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;event received:&#39;</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
<span class="p">});</span>
<span class="c1">// dispatch an event</span>
<span class="kd">var</span> <span class="nx">event</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createEvent</span><span class="p">(</span><span class="s2">&quot;Event&quot;</span><span class="p">);</span>
<span class="nx">event</span><span class="p">.</span><span class="nx">initEvent</span><span class="p">(</span><span class="s2">&quot;some-event&quot;</span><span class="p">);</span>
<span class="nx">dispatcher</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/9oOdvqPtMdUpg6DuKCLS?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Listening to events</h2>
			<a class="anchor" name="listening-to-events"></a>
		</div>

		<p>The dispatcher implements the same interface as the DOM Event specification, the methods "addEventListener" and "removeEventListener" can be used to listen and stop listening to events.</p>

		<div><h4>A simple example</h4></div>

		<p>In the following example, an event is dispatched from the application instance, and listened to both in the application instance and a view entity.</p>

		<div class="highlight"><pre><span class="kd">var</span> <span class="nx">View</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dispatcher</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">dispatcher</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;some-event&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;event received in a view:&#39;</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">MyApplication</span> <span class="o">=</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">.</span><span class="nx">createInstance</span><span class="p">(</span><span class="nx">View</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// listen to an event</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">dispatcher</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;some-event&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;event received:&#39;</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="c1">// dispatch an event</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">dispatcher</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s1">&#39;some-event&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyApplication</span><span class="p">();</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/GXzRmRwbWNpBnykBqBpS?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div><h4>Event handlers scope and binding</h4></div>

		<p>As with events dispatched from the DOM, the scope of the event handlers (this) might not be the expected scope. To solve this common javascript problem, a "bind" method can be used.</p>
		<p><code>Function.prototype.bind</code> is part of ECMAScript 5 and soma.js has implemented a shim for older browsers. <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Function/bind" target="_blank">Click here for more information about the bind method</a>.</p>
		<p>In the following example, one event is dispatched and two functions are listening to it. In the first function, the "this" is the window. In the second function the "this" is the application instance as the bind function changes the scope of the event handler, making the instance variable accessible.</p>

		<div class="highlight"><pre><span class="c1">// instance variable</span>
<span class="k">this</span><span class="p">.</span><span class="nx">myVariable</span> <span class="o">=</span> <span class="s2">&quot;myValue&quot;</span><span class="p">;</span>

<span class="c1">// listen to an event without binding</span>
<span class="k">this</span><span class="p">.</span><span class="nx">dispatcher</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;some-event&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// &quot;this&quot; is window</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;instance variable not accessible:&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">myVariable</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// listen to an event with binding</span>
<span class="k">this</span><span class="p">.</span><span class="nx">dispatcher</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;some-event&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// &quot;this&quot; is the application instance</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;instance variable accessible:&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">myVariable</span><span class="p">);</span>
<span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

<span class="c1">// dispatch an event</span>
<span class="k">this</span><span class="p">.</span><span class="nx">dispatcher</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s1">&#39;some-event&#39;</span><span class="p">);</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/sYuaBogeYGgT7AeNCWme?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<p>A quick note about removing listeners. The bind method creates a new function, removing a listener using the bind method will not work as the event handler will be a new function (<a href="https://github.com/soundstep/soma-events" target="_blank">see some-event documentation</a>).</p>
		<p>Here is the solution to properly remove listeners using the bind method.</p>

		<div class="highlight"><pre><span class="c1">// event handler</span>
<span class="kd">var</span> <span class="nx">eventHandler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// will not be triggered as the listener is properly removed</span>
<span class="p">}</span>
<span class="c1">// bound event handler reference</span>
<span class="kd">var</span> <span class="nx">boundEventHandler</span> <span class="o">=</span> <span class="nx">eventHandler</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="c1">// listen to an event</span>
<span class="k">this</span><span class="p">.</span><span class="nx">dispatcher</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;some-event&#39;</span><span class="p">,</span> <span class="nx">boundEventHandler</span><span class="p">);</span>
<span class="c1">// stop listening to an event</span>
<span class="k">this</span><span class="p">.</span><span class="nx">dispatcher</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;some-event&#39;</span><span class="p">,</span> <span class="nx">boundEventHandler</span><span class="p">);</span>
<span class="c1">// dispatch an event</span>
<span class="k">this</span><span class="p">.</span><span class="nx">dispatcher</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s1">&#39;some-event&#39;</span><span class="p">);</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/vGRDmdxKeiGY61lDKSUt?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Send parameters</h2>
			<a class="anchor" name="send-parameters"></a>
		</div>

		<p>Parameters can be sent when dispatching events, so the events handlers can receive information. The parameters are store on the <code>event.params</code> property of an event.</p>

		<div class="highlight"><pre><span class="nx">dispatcher</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s1">&#39;some-event&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">data</span><span class="o">:</span><span class="s1">&#39;some data&#39;</span><span class="p">});</span>
<span class="nx">dispatcher</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="k">new</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s1">&#39;some-event&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">data</span><span class="o">:</span><span class="s1">&#39;some data&#39;</span><span class="p">}));</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/FFv5llnIS4Tmb70MeLy5?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Command</h1>
			<a class="anchor" name="command"></a>
		</div>

		<p>A <a href="http://en.wikipedia.org/wiki/Command_pattern" target="_blank">command</a> is behavioral design pattern to help reducing dependencies. An object is used to encapsulate the information needed to call a method, including the object owning the method, the object itself and any parameters.</p>
		<p>Concretely, a command is a function instantiated by the framework, created for any re-usable action that could be performed in various places of the application. A command is meant to be created, used and discarded straight away. A command should never be used to hold data, and should be executable at any time without causing errors in the system.</p>

		<div class="subtitle">
			<h2>Create commands</h2>
			<a class="anchor" name="create-commands"></a>
		</div>

		<p>A command in soma.js is nothing more than a simple function that contains an <code>execute</code> method that will receive the event instance used to trigger it. Dependency injection can be used to retrieve useful objects.</p>

		<div class="highlight"><pre><span class="kd">var</span> <span class="nx">Command</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">myModel</span><span class="p">,</span> <span class="nx">myView</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">execute</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Manage commands</h2>
			<a class="anchor" name="manage-commands"></a>
		</div>

		<div><h4>Add a command</h4></div>

		<p>Commands in soma.js are triggered using events. This makes possible for the application actors to, not only execute commands, but also listen to events used to trigger the commands.</p>
		<p>The <code>commands</code> core element is used to managed the commands. It is a good practice, unless you are building self-contained modules, to add all the commands in the same place, such as the application instance. This would give a good overview for a potential new developer to get an idea of what is possible to do in the application using the commands.</p>

		<div class="highlight"><pre><span class="k">this</span><span class="p">.</span><span class="nx">commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;some-event&quot;</span><span class="p">,</span> <span class="nx">Command</span><span class="p">);</span></pre></div>

		<div><h4>Remove a command</h4></div>

		<p>The <code>commands</code> core element contains several useful methods to manage the commands, such as <code>has</code>, <code>get</code> and <code>getAll</code>. To remove a command, the <code>remove</code> method can be used.</p>

		<div class="highlight"><pre><span class="k">this</span><span class="p">.</span><span class="nx">commands</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">&quot;some-event&quot;</span><span class="p">);</span></pre></div>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>A simple command example</h2>
			<a class="anchor" name="simple-command-example"></a>
		</div>

		<p>The following example contains a <code>Navigation</code> model, its role is to display a screen using an ID. A Command is created to call the navigation method. The command is mapped to a "show-screen" event, which is used to send the ID of a screen. This setup makes possible, for any actor of the application, to dispatch an event to show a screen.</p>

		<div class="highlight"><pre><span class="kd">var</span> <span class="nx">Navigation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{};</span>
<span class="nx">Navigation</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">showScreen</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Display screen:&#39;</span><span class="p">,</span> <span class="nx">id</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">Command</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">navigation</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">execute</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Command executed with parameter:&quot;</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">);</span>
    <span class="nx">navigation</span><span class="p">.</span><span class="nx">showScreen</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">MyApplication</span> <span class="o">=</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">.</span><span class="nx">mapClass</span><span class="p">(</span><span class="s2">&quot;navigation&quot;</span><span class="p">,</span> <span class="nx">Navigation</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;show-screen&quot;</span><span class="p">,</span> <span class="nx">Command</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">dispatcher</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s2">&quot;show-screen&quot;</span><span class="p">,</span> <span class="s2">&quot;home&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyApplication</span><span class="p">();</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/hPxftFSFhtmMe5D0hdbT?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Flow control</h2>
			<a class="anchor" name="flow-control"></a>
		</div>

		<p>Being able to control the flow of an application is important. Some components might decide to execute a command, but some other components might have the need to monitor or even interrupt the application flow. A good example could be a "logout" command in an editor application. A menu component can decide to execute this command, but the editor should be able to intercept and interrupt it in case the user didn't save his current file.</p>
		<p>As the commands are using events to be triggered, the DOM Event provides the necessary tools to monitor (addEventListener) and interrupt a command (event.preventDefault).</p>
		<p>In the following example, a command is executed and an external <code>Monitor</code> entity is able to monitor this command by listening to the event.</p>

		<div class="highlight"><pre><span class="kd">var</span> <span class="nx">Monitor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dispatcher</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">dispatcher</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;some-event&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Command monitored&quot;</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">Command</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">execute</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Command executed&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">MyApplication</span> <span class="o">=</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;some-event&quot;</span><span class="p">,</span> <span class="nx">Command</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">.</span><span class="nx">createInstance</span><span class="p">(</span><span class="nx">Monitor</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">dispatcher</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s2">&quot;some-event&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyApplication</span><span class="p">();</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/VHLPtSJgsBNgNFzgf1x6?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<p>In the following example, the <code>start</code> method dispatch an event to logout a user. The <code>EditorModel</code> is able to monitor the logout command and interrupt it.</p>
		<p>The initiator of the command can decide when dispatching the event, if another component should be able to interrupt it. A DOM Event has a <code>cancelable</code> property that should be set to true when dispatched so another component can interrupt it using the <code>event.preventDefaut()</code> method.</p>

		<div class="highlight"><pre><span class="kd">var</span> <span class="nx">EditorModel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dispatcher</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">dispatcher</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;logout&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Logout event received in EditorModel&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">fileSaved</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Interupt logout command&#39;</span><span class="p">);</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">LogoutCommand</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">execute</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Logout user&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">EditorApplication</span> <span class="o">=</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;logout&quot;</span><span class="p">,</span> <span class="nx">LogoutCommand</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">.</span><span class="nx">createInstance</span><span class="p">(</span><span class="nx">EditorModel</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// dispatch a cancelable event</span>
    <span class="c1">// dispatch(eventType, parameters, bubbles, cancelable)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">dispatcher</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s2">&quot;logout&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EditorApplication</span><span class="p">();</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/xQtwi2nMDAh3Z2zL1iz0?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Mediator</h1>
			<a class="anchor" name="mediator"></a>
		</div>

		<p>A mediator is a behavioral design pattern that is used to reduce dependencies. Concretely, a mediator is an object that represents another object, the communication between objects can be encapsulated within the mediators rather than the objects it represents, reducing coupling.</p>

		<div class="subtitle">
			<h2>Create mediators</h2>
			<a class="anchor" name="create-mediators"></a>
		</div>

		<p>The core element <code>mediators</code> can be used to create mediators. It contains a single <code>create</code> method as the mediators and objects represented are not stored by the framework.</p>
		<p>The <code>create</code> method requires two parameters. The first parameter is a function instantiated by the framework, the mediator itself. The second parameter is either a single object or a list of objects (array, node list, and so on).</p>
		<p>Mediators are also useful to represent several targets with the same function (<a href="http://en.wikipedia.org/wiki/Don't_repeat_yourself" target="_blank">DRY</a>). The <code>create</code> method will instantiate as many mediators needed and return them.</p>
		<p>A <code>target</code> parameter will be injected to get a reference of the object represented.</p>

		<div class="highlight"><pre><span class="kd">function</span> <span class="nx">Mediator</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// target is the object represented</span>
<span class="p">};</span>
<span class="c1">// create mediator with a single object</span>
<span class="kd">var</span> <span class="nx">mediators</span> <span class="o">=</span> <span class="nx">mediators</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">MyMediator</span><span class="p">,</span> <span class="nx">object</span><span class="p">);</span>
<span class="c1">// create mediator with a list of objects</span>
<span class="kd">var</span> <span class="nx">mediators</span> <span class="o">=</span> <span class="nx">mediators</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">MyMediator</span><span class="p">,</span> <span class="p">[</span><span class="nx">object1</span><span class="p">,</span> <span class="nx">object2</span><span class="p">,</span> <span class="nx">object3</span><span class="p">]);</span>
</pre></div>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Simple mediator example</h2>
			<a class="anchor" name="simple-mediator-example"></a>
		</div>

		<p>In the following example, a mediator that represents a DOM Element is created, paradoxically called "view" on purpose (see next example).</p>
		<p>The mediator updates its target, a DOM Element, when it receives a specific event.</p>

		<div class="highlight"><pre><span class="kd">var</span> <span class="nx">TitleView</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">dispatcher</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// listen to the event &quot;render-title&quot; to update the target (DOM Element)</span>
  <span class="nx">dispatcher</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;render title&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">target</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">Application</span> <span class="o">=</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// create a mediator that represents a DOM Element</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">mediators</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">TitleView</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">));</span>
  <span class="p">},</span>
  <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// dispatch an event to trigger an action in the mediator</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">dispatcher</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s1">&#39;render title&#39;</span><span class="p">,</span> <span class="s2">&quot;This is a title&quot;</span><span class="p">);</span>
  <span class="p">},</span>
<span class="p">});</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/E9PND7pyY81QT9u8cRlH?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Decoupling communication</h2>
			<a class="anchor" name="decoupling-communication"></a>
		</div>

		<p>The previous example can be taken even further to create a highly re-usable object. The goal is to create a view that is only a DOM Element wrapper and stripped off any framework and communication code. The view can provide a set of methods to update its content, and the communication with the framework can be moved to another mediator.</p>
		<p>Responsibilities will be completely separated as the view will only take care of displaying content, and the mediator will be responsible of providing the view the right content, at the right moment. The result are components that are highly decoupled and more maintainable.</p>
		<p>The following example also show how to use a single view function and a single mediator function, to handle multiple DOM Elements.</p>

		<div class="highlight"><pre><span class="nt">&lt;h1</span> <span class="na">data-id=</span><span class="s">&#39;first&#39;</span><span class="nt">&gt;&lt;/h1&gt;</span>
<span class="nt">&lt;h1</span> <span class="na">data-id=</span><span class="s">&#39;second&#39;</span><span class="nt">&gt;&lt;/h1&gt;</span>
<span class="nt">&lt;h1</span> <span class="na">data-id=</span><span class="s">&#39;third&#39;</span><span class="nt">&gt;&lt;/h1&gt;</span>

<span class="c1">// model containing title strings</span>
<span class="kd">var</span> <span class="nx">TitleModel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">first</span><span class="o">:</span> <span class="s1">&#39;First title&#39;</span><span class="p">,</span>
    <span class="nx">second</span><span class="o">:</span> <span class="s1">&#39;Second title&#39;</span><span class="p">,</span>
    <span class="nx">third</span><span class="o">:</span> <span class="s1">&#39;Third title&#39;</span>
  <span class="p">};</span>
<span class="p">};</span>
<span class="nx">TitleModel</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getTitle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
<span class="p">};</span>

<span class="c1">// view representing a DOM element</span>
<span class="kd">var</span> <span class="nx">TitleView</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">element</span> <span class="o">=</span> <span class="nx">target</span><span class="p">;</span>
<span class="p">};</span>
<span class="nx">TitleView</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setTitle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// mediator representing a view</span>
<span class="kd">var</span> <span class="nx">TitleMediator</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">dispatcher</span><span class="p">,</span> <span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">dispatcher</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;render title&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-id&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">model</span><span class="p">.</span><span class="nx">getTitle</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
    <span class="nx">target</span><span class="p">.</span><span class="nx">setTitle</span><span class="p">(</span><span class="nx">title</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">Application</span> <span class="o">=</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// map model to inject in mediators</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">.</span><span class="nx">mapClass</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="nx">TitleModel</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="c1">// create views (mediators representing a DOM element)</span>
    <span class="kd">var</span> <span class="nx">views</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">mediators</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">TitleView</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">));</span>
    <span class="c1">// create mediators (mediators representing a view)</span>
    <span class="kd">var</span> <span class="nx">mediators</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">mediators</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">TitleMediator</span><span class="p">,</span> <span class="nx">views</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// dispatch an event to render the titles</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">dispatcher</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s1">&#39;render title&#39;</span><span class="p">,</span> <span class="s2">&quot;This is a title&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Application</span><span class="p">();</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/vb4jexiMS6oejbWHPAvi?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Template</h1>
			<a class="anchor" name="template"></a>
		</div>

		<p><a href="http://soundstep.github.io/soma-template/" target="_blank">soma-template</a> is an optional DOM template engine library implemented in soma.js, <a href="http://soundstep.github.io/soma-template/" target="_blank">click here to see the soma-template documentation and tests</a>.</p>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Load the soma-template plugin</h2>
			<a class="anchor" name="load-template-plugin"></a>
		</div>

		<p>Simply load the template engine just after loading the soma.js framework. No further actions are needed to use the soma-template library.</p>

		<div class="highlight"><pre><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;soma.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;soma-template.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Create a template</h2>
			<a class="anchor" name="create-a-template"></a>
		</div>

		<p>The framework provides a method <code>createTemplate</code> that will instantiate a mediator and receive a <code>template</code>, <code>scope</code> and <code>element</code> parameters so that the DOM can be manipulated in an easy way.</p>

		<div class="highlight"><pre><span class="kd">var</span> <span class="nx">Template</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">template</span><span class="p">,</span> <span class="nx">scope</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>

<span class="p">};</span>

<span class="k">this</span><span class="p">.</span><span class="nx">createTemplate</span><span class="p">(</span><span class="nx">Template</span><span class="p">,</span> <span class="nx">domElement</span><span class="p">);</span>
</pre></div>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Simple template example</h2>
			<a class="anchor" name="simple-template-example"></a>
		</div>

		<p>In the following example a template is created using a template function and a reference to a DOM Element. The template will ask the injector a model that contains the data to be displayed.</p>

		<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;app&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h1&gt;</span><span class="cp">{{</span><span class="nv">content.title</span><span class="cp">}}</span><span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">data-repeat=</span><span class="s">&quot;item in content.items&quot;</span><span class="nt">&gt;</span><span class="cp">{{</span><span class="nv">$index</span><span class="cp">}}</span> - <span class="cp">{{</span><span class="nv">item</span><span class="cp">}}</span><span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="c1">// function model containing data (text to display)</span>
<span class="kd">var</span> <span class="nx">Model</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;This is a title&quot;</span><span class="p">,</span>
    <span class="nx">items</span><span class="o">:</span> <span class="p">[</span>
      <span class="s2">&quot;First item&quot;</span><span class="p">,</span>
      <span class="s2">&quot;Second item&quot;</span><span class="p">,</span>
      <span class="s2">&quot;Third item&quot;</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// function template that will update the DOM</span>
<span class="kd">var</span> <span class="nx">Template</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">template</span><span class="p">,</span> <span class="nx">scope</span><span class="p">,</span> <span class="nx">element</span><span class="p">,</span> <span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">scope</span><span class="p">.</span><span class="nx">content</span> <span class="o">=</span> <span class="nx">model</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
  <span class="nx">template</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
<span class="p">};</span>

<span class="c1">// application function</span>
<span class="kd">var</span> <span class="nx">Application</span> <span class="o">=</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// model mapping rule so it can be injected in the template</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">.</span><span class="nx">mapClass</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="nx">Model</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="c1">// create a template for a specific DOM element</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">createTemplate</span><span class="p">(</span><span class="nx">Template</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;.app&#39;</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// create application</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Application</span><span class="p">();</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/jqNzBAow23H7uZrZ974m?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>OOP</h1>
			<a class="anchor" name="oop"></a>
		</div>

		<p>Javascript is an object oriented language, but do not have built-in classes, private members, inheritance, interfaces and other common features found in other languages.</p>
		<p>There are a lot of debates whether you should emulate classes, but the fact is, some inheritance capabilities are sometimes needed not to duplicate code (<a href="http://en.wikipedia.org/wiki/Don't_repeat_yourself" target="_blank">DRY principle</a>).</p>
		<p>Inheritance is very useful in many cases but must not be overused, <a href="http://en.wikipedia.org/wiki/Composition_over_inheritance" target="_blank">composition over inheritance</a> is usually a better design in the long term. The solution is using the right pattern for the right problem.</p>
		<p>soma.js provides some useful utility functions to emulate inheritance.</p>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Inheritance</h2>
			<a class="anchor" name="inheritance"></a>
		</div>

		<p>In the following example, a function <code>Person</code> is created, along with a <code>say</code> method. A second function <code>Man</code> is created and inherits from its parent.</p>
		<p>The <code>Man</code> constructor calls its parent constructor sending a parameter (<code>name</code>) so the assignment is not broken. The <code>Man.prototype.say</code> overrides its parent <code>say</code> method so it can display a more specific message.</p>

		<div class="highlight"><pre><span class="c1">// create &quot;super class&quot;</span>
<span class="kd">var</span> <span class="nx">Person</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
<span class="p">};</span>
<span class="nx">Person</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">say</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;I&#39;m a Person, my name is:&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// create &quot;child class&quot; that will inherit from its parent</span>
<span class="kd">var</span> <span class="nx">Man</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">Person</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span> <span class="c1">// call super constructor</span>
<span class="p">}</span>
<span class="nx">Man</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">say</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Person.prototype.say.call(this); // call super say method</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;I&#39;m a Man, my name is:&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// apply inheritance</span>
<span class="nx">soma</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">Person</span><span class="p">,</span> <span class="nx">Man</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>

<span class="c1">// create Person</span>
<span class="kd">var</span> <span class="nx">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="s2">&quot;Doe&quot;</span><span class="p">);</span>
<span class="nx">person</span><span class="p">.</span><span class="nx">say</span><span class="p">();</span>

<span class="c1">// create Man</span>
<span class="kd">var</span> <span class="nx">john</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Man</span><span class="p">(</span><span class="s2">&quot;John Doe&quot;</span><span class="p">);</span>
<span class="nx">john</span><span class="p">.</span><span class="nx">say</span><span class="p">();</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/IIHqPwNuikn5E7MoQoLM?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<p>Here is a different syntax using an object to create the <code>Man</code> function. The result is exactly the same as the previous example.</p>

		<div class="highlight"><pre><span class="c1"><span class="c1">// create &quot;child class&quot; that will inherit from its parent</span>
<span class="c1">// apply inheritance using an object that will become the prototype</span>
<span class="kd">var</span> <span class="nx">Man</span> <span class="o">=</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">Person</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Person</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span> <span class="c1">// call super constructor</span>
  <span class="p">},</span>
  <span class="nx">say</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Person.prototype.say.call(this); // call super say method</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;I&#39;m a Man, my name is:&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/atRF1AA5SRs5EnEhpFZV?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Extend method shortcut</h2>
			<a class="anchor" name="extend-method-shortcut"></a>
		</div>

		<p>Here is small snippet to attach a method and easily apply inheritance on a function.</p>

		<div class="highlight"><pre><span class="c1">// create shortcut extend method</span>
<span class="nx">Person</span><span class="p">.</span><span class="nx">extend</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">Person</span><span class="p">,</span> <span class="nx">obj</span><span class="p">);</span>
<span class="p">};</span>
<span class="c1">// create &quot;child class&quot; using the extend shortcut</span>
<span class="kd">var</span> <span class="nx">Man</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>

<span class="p">});</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/ipL2XpdgS6BvjVYJvcYD?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Call super constructor and methods</h2>
			<a class="anchor" name="call-super-constructor-and-methods"></a>
		</div>

		<p>The way used to call a parent constructor and a method up in the prototypal chain in the previous example is the native javascript way of doing it.</p>

		<div class="highlight"><pre><span class="c1">// call parent constructor</span>
<span class="nx">ParentFunction</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">param</span><span class="p">);</span>
<span class="c1">// call parent prototype method</span>
<span class="nx">ParentFunction</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">myMethod</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">param</span><span class="p">);</span>
</pre></div>

		<p>soma.js offers a slightly different way of writing calls to the parents. Note that this syntax is not pure javascript, this is a soma.js enhancement, use it only if the application benefit of not writing the parent function name explicitly.</p>

		<div class="highlight"><pre><span class="c1">// call parent constructor</span>
<span class="nx">CurrentFunction</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">param</span><span class="p">);</span>
<span class="c1">// call parent prototype method</span>
<span class="nx">CurrentFunction</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">myMethod</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">param</span><span class="p">);</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/AFeM5fIlUlUO5OhKpI94?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Plugins</h1>
			<a class="anchor" name="plugins"></a>
		</div>

		<p>soma.js provide an interface to create plugins to add new features to the framework.</p>
		<p>The <a href="http://soundstep.github.io/soma-template/" target="_blank">soma-template</a> plugin is a self-contained library with no dependency, but can also be added to soma.js as a plugin. soma-template is adding DOM manipulation capabilities and a custom method to create template directly in the framework (<code>instance.createTemplate</code>).</p>
		<p>A plugin is a function that can receive framework core elements and custom parameters. The plugin can be instantiated using the method <code>createPlugin</code>, the first parameter is the plugin function to be instantiated and the others parameters will be sent the plugin constructor.</p>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Create a plugin</h2>
			<a class="anchor" name="create-a-plugin"></a>
		</div>

		<p>Plugins can be either dependent or independent to the framework, it is only a matter of choice. The following example show a simple structure to create a plugin.</p>

		<div class="highlight"><pre><span class="nt">&lt;script&gt;</span>
<span class="c1">// plugin</span>
<span class="kd">var</span> <span class="nx">Plugin</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">dispatcher</span><span class="p">,</span> <span class="nx">injector</span><span class="p">,</span> <span class="nx">customParameter</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// framework core elements can be injected as well custom parameters</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Plugin created with&#39;</span><span class="p">,</span> <span class="nx">customParameter</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">Application</span> <span class="o">=</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// create a plugin</span>
    <span class="kd">var</span> <span class="nx">plugin</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createPlugin</span><span class="p">(</span><span class="nx">Plugin</span><span class="p">,</span> <span class="s1">&#39;custom parameter&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Application</span><span class="p">();</span>
<span class="nt">&lt;/script&gt;</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/zpv15klrAJ2eTIRWGV6i?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Mouse plugin</h2>
			<a class="anchor" name="mouse-plugin"></a>
		</div>

		<p>The following example creates a <code>MousePlugin</code> and an injection mapping rule so it can be used anywhere in the application. The MousePlugin provide a <code>getPosition</code> method to retrieve the mouse coordinates, as well as a dispose function to "destroy" the plugin.</p>
		<p>Providing a <code>dispose</code> method is a good practice to properly destroy an object. Listeners can be removed, internal objects can be destroyed, so the object can be <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Memory_Management" target="_blank">garbage collected</a>.</p>

		<div class="highlight"><pre><span class="c1">// plugin to retrieve the mouse coordinates</span>
<span class="kd">var</span> <span class="nx">MousePlugin</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// object holding mouse position</span>
  <span class="kd">var</span> <span class="nx">position</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">y</span><span class="o">:</span> <span class="mi">0</span>
  <span class="p">};</span>
  <span class="c1">// event handler storing the mouse position</span>
  <span class="kd">var</span> <span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">position</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">clientX</span><span class="p">;</span>
    <span class="nx">position</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">clientY</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">//add event</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mousemove&#39;</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
  <span class="c1">// returns a getPosition method to retrieve the mouse position</span>
  <span class="c1">// returns a dispose method to remove the listener</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">getPosition</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">position</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">dispose</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;mousemove&#39;</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// create the plugin</span>
<span class="kd">var</span> <span class="nx">mouse</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createPlugin</span><span class="p">(</span><span class="nx">MousePlugin</span><span class="p">);</span>
<span class="c1">// create a mapping rule</span>
<span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">.</span><span class="nx">mapValue</span><span class="p">(</span><span class="s1">&#39;mouse&#39;</span><span class="p">,</span> <span class="nx">mouse</span><span class="p">);</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/aGTAeUm42GxCGgA1RxVZ?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Ready plugin (auto-registration)</h2>
			<a class="anchor" name="ready-plugin"></a>
		</div>

		<p>The following plugin (<code>ReadyPlugin</code>) alters the prototype of the soma.js application and add a <code>ready</code> method to it. The <code>ready</code> method is used to add callbacks for the application to know when the DOM has been fully loaded.</p>
		<p>An event could have been dispatched but for the sake of the demonstration. the application prototype has been altered to show a direct use of a plugin. The <code>ready</code> function is used both in the application instance and in the view.</p>
		<p>The plugin is also not created by the user application instance. The plugin is "auto-registered" and will be made available by the framework automatically. This makes the creation of a plugin possible without further actions, by executing its code, or by loading a javascript file containing the plugin.</p>

		<div class="highlight"><pre><span class="c1">// plugin to add callbacks when the dom is ready</span>
<span class="kd">var</span> <span class="nx">ReadyPlugin</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ready function to add callbacks when the DOM is loaded (https://github.com/ded/domready)</span>
  <span class="kd">var</span> <span class="nx">ready</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="kd">function</span> <span class="nx">l</span><span class="p">(</span><span class="nx">b</span><span class="p">){</span><span class="k">for</span><span class="p">(</span><span class="nx">k</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="nx">b</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">shift</span><span class="p">();)</span><span class="nx">b</span><span class="p">()}</span><span class="kd">var</span> <span class="nx">b</span><span class="p">,</span><span class="nx">a</span><span class="o">=</span><span class="p">[],</span><span class="nx">c</span><span class="o">=!</span><span class="mi">1</span><span class="p">,</span><span class="nx">d</span><span class="o">=</span><span class="nb">document</span><span class="p">,</span><span class="nx">e</span><span class="o">=</span><span class="nx">d</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">,</span><span class="nx">f</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">doScroll</span><span class="p">,</span><span class="nx">g</span><span class="o">=</span><span class="s2">&quot;DOMContentLoaded&quot;</span><span class="p">,</span><span class="nx">h</span><span class="o">=</span><span class="s2">&quot;addEventListener&quot;</span><span class="p">,</span><span class="nx">i</span><span class="o">=</span><span class="s2">&quot;onreadystatechange&quot;</span><span class="p">,</span><span class="nx">j</span><span class="o">=</span><span class="s2">&quot;readyState&quot;</span><span class="p">,</span><span class="nx">k</span><span class="o">=</span><span class="sr">/^loade|c/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="nx">j</span><span class="p">]);</span><span class="k">return</span> <span class="nx">d</span><span class="p">[</span><span class="nx">h</span><span class="p">]</span><span class="o">&amp;&amp;</span><span class="nx">d</span><span class="p">[</span><span class="nx">h</span><span class="p">](</span><span class="nx">g</span><span class="p">,</span><span class="nx">b</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="nx">d</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="nx">g</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">c</span><span class="p">),</span><span class="nx">l</span><span class="p">()},</span><span class="nx">c</span><span class="p">),</span><span class="nx">f</span><span class="o">&amp;&amp;</span><span class="nx">d</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">b</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="sr">/^c/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="nx">j</span><span class="p">])</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">detachEvent</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">b</span><span class="p">),</span><span class="nx">l</span><span class="p">())}),</span><span class="nx">f</span><span class="o">?</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">){</span><span class="nx">self</span><span class="o">!=</span><span class="nx">top</span><span class="o">?</span><span class="nx">k</span><span class="o">?</span><span class="nx">b</span><span class="p">()</span><span class="o">:</span><span class="nx">a</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">try</span><span class="p">{</span><span class="nx">e</span><span class="p">.</span><span class="nx">doScroll</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">)}</span><span class="k">catch</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span><span class="k">return</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">ready</span><span class="p">(</span><span class="nx">b</span><span class="p">)},</span><span class="mi">50</span><span class="p">)}</span><span class="nx">b</span><span class="p">()}()}</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">){</span><span class="nx">k</span><span class="o">?</span><span class="nx">b</span><span class="p">()</span><span class="o">:</span><span class="nx">a</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">b</span><span class="p">)}}();</span>
  <span class="c1">// add the ready function to the prototype of the soma.js application for a direct use</span>
  <span class="nx">instance</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">ready</span> <span class="o">=</span> <span class="nx">ready</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// auto-registration, the plugin will be instantiated automatically by soma.js</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">soma</span><span class="p">.</span><span class="nx">plugins</span> <span class="o">&amp;&amp;</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">add</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">soma</span><span class="p">.</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">ReadyPlugin</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// view</span>
<span class="kd">var</span> <span class="nx">View</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">instance</span><span class="p">.</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">target</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;DOM is loaded&#39;</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">Application</span> <span class="o">=</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// use the plugin</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;DOM READY&#39;</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">},</span>
  <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// create a view</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">mediators</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">View</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;.report&#39;</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Application</span><span class="p">();</span>
</pre></div>

		<p><a href="http://plnkr.co/edit/oTsfM594TXVKo1HmROLL?p=preview" class="button icon edit" target="_blank">try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

		<div class="subtitle">
			<h2>Orientation plugin</h2>
			<a class="anchor" name="orientation-plugin"></a>
		</div>

		<p>The role of the following plugin (<code>OrientationPlugin</code>), is to detect an orientation change on a mobile device, either portait or landscape. The orientation can be retrieve at any moment from the plugin, but the plugin will also dispatch an event when the device orientation changes. This makes possible for another entities to simply listen to this events to update its state.</p>

		<div class="highlight"><pre><span class="c1">// plugin to retrieve the mouse coordinates</span>
<span class="kd">var</span> <span class="nx">OrientationPlugin</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dispatcher</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// hold current orientation</span>
  <span class="kd">var</span> <span class="nx">orientation</span> <span class="o">=</span> <span class="nx">detectDeviceOrientation</span><span class="p">();</span>
  <span class="c1">// add listener to detect orientation change</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;orientationchange&#39;</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
  <span class="c1">// store the new orientation and dispatch an event</span>
  <span class="kd">function</span> <span class="nx">handler</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">orientation</span> <span class="o">=</span> <span class="nx">detectDeviceOrientation</span><span class="p">();</span>
    <span class="nx">dispatcher</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s1">&#39;orientation&#39;</span><span class="p">,</span> <span class="nx">orientation</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// return the orientation, portait or landscape</span>
  <span class="kd">function</span> <span class="nx">detectDeviceOrientation</span><span class="p">(){</span>
    <span class="k">switch</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">orientation</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="mi">90</span><span class="o">:</span>
      <span class="k">case</span> <span class="o">-</span><span class="mi">90</span><span class="o">:</span>
        <span class="k">return</span> <span class="s1">&#39;landscape&#39;</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
      <span class="k">case</span> <span class="mi">180</span><span class="o">:</span>
      <span class="k">default</span><span class="o">:</span>
        <span class="k">return</span> <span class="s1">&#39;portait&#39;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="c1">// return plugin API</span>
  <span class="c1">// getOrientation returns either landscape or portait</span>
  <span class="c1">// dispose removes the listener</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">getOrientation</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">orientation</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">dispose</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;orientationchange&#39;</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// view</span>
<span class="kd">var</span> <span class="nx">View</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">dispatcher</span><span class="p">,</span> <span class="nx">orientation</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// display the orientation when the view is created</span>
  <span class="nx">updateOrientation</span><span class="p">(</span><span class="nx">orientation</span><span class="p">.</span><span class="nx">getOrientation</span><span class="p">());</span>
  <span class="c1">// listen to the event dispatched by the plugin</span>
  <span class="nx">dispatcher</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;orientation&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// display the orientation when a change happened</span>
    <span class="nx">updateOrientation</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">);</span>
  <span class="p">})</span>
  <span class="c1">// display the orientation in the DOM Element</span>
  <span class="kd">function</span> <span class="nx">updateOrientation</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">target</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;Current orientation: &#39;</span> <span class="o">+</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">Application</span> <span class="o">=</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// create the plugin</span>
    <span class="kd">var</span> <span class="nx">plugin</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createPlugin</span><span class="p">(</span><span class="nx">OrientationPlugin</span><span class="p">);</span>
    <span class="c1">// create a mapping rule</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">.</span><span class="nx">mapValue</span><span class="p">(</span><span class="s1">&#39;orientation&#39;</span><span class="p">,</span> <span class="nx">plugin</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// create a view</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">mediators</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">View</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;.report&#39;</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Application</span><span class="p">();</span>
</pre></div>

		<p><a href="http://run.plnkr.co/plunks/qJthopgArZx8t5yusxKn/" class="button icon edit" target="_blank">Test on a mobile device</a></p>
		<p><a href="http://plnkr.co/edit/qJthopgArZx8t5yusxKn?p=preview" class="button icon edit" target="_blank">Try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Router</h1>
			<a class="anchor" name="router"></a>
		</div>

		<p>soma.js does not provide a built-in router to take care of path and url. However, <a href="https://github.com/flatiron/director" target="_blank">Director</a> is a great library that is focused on routing.</p>
		<p>The library is very featured, fully tested, does not have any dependency and can be seamlessly integrated in the framework. Director also support the <a href="https://github.com/flatiron/director#history-api" target="_blank">HTML 5 history API</a>.</p>

		<p><a href="https://github.com/flatiron/director" class="button icon tag" target="_blank">Get Director</a></p>
		
		<p><a href="../demos/todo-hash" target="_blank">Click here to see the todo app</a> that integrates Director.</p>

		<p>Here is a simple example to implement Director in a soma.js application.</p>

		<div class="highlight"><pre><span class="kd">var</span> <span class="nx">Navigation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">router</span><span class="p">,</span> <span class="nx">dispatcher</span><span class="p">)</span> <span class="p">{</span>

  <span class="c1">// setup routes and dispatch views ids</span>

  <span class="nx">router</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="s1">&#39;/home&#39;</span><span class="p">);</span>

  <span class="nx">router</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;/home&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">dispatchRoute</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">router</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;/page1&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">dispatchRoute</span><span class="p">(</span><span class="s1">&#39;page1&#39;</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">router</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;/page2&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">dispatchRoute</span><span class="p">(</span><span class="s1">&#39;page2&#39;</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="c1">// in this demo, all routes could have been handled with this single regex route</span>
  <span class="c1">// router.on(/.*/, function() {</span>
  <span class="c1">//   dispatchRoute(router.getRoute()[0]);</span>
  <span class="c1">// });</span>

  <span class="kd">function</span> <span class="nx">dispatchRoute</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">dispatcher</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s1">&#39;show-view&#39;</span><span class="p">,</span> <span class="nx">id</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">};</span>

<span class="kd">var</span> <span class="nx">View</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">dispatcher</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">dispatcher</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;show-view&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">isCurrentView</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">className</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">params</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="nx">target</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="nx">isCurrentView</span> <span class="o">?</span> <span class="s1">&#39;block&#39;</span> <span class="o">:</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">Application</span> <span class="o">=</span> <span class="nx">soma</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// create the Director router and make it available through the framework</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">.</span><span class="nx">mapValue</span><span class="p">(</span><span class="s1">&#39;router&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Router</span><span class="p">());</span>
    <span class="c1">// create mediators for the views (DOM Element)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">mediators</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">View</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;.view&#39;</span><span class="p">))</span>
  <span class="p">},</span>
  <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// instantiate Navigation to start the app</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">.</span><span class="nx">createInstance</span><span class="p">(</span><span class="nx">Navigation</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Application</span><span class="p">();</span>
</pre></div>


		<p><a href="http://plnkr.co/edit/7QwQFHhITvXN9U7zkfcW?p=preview" class="button icon edit" target="_blank">Try it yourself</a></p>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Demos</h1>
			<a class="anchor" name="demos"></a>
		</div>

		<ul>
			<li>
				<a href="../demos/helloworld" target="_blank">Hello world</a>
				<p>Demo displaying a string. The application contains a model, a mediator and uses an event to display the string in a DOM Element.</p>
			</li>
			<li>
				<a href="../demos/twitter" target="_blank">Twitter search</a>
				<p>Demo searching in the Twitter API and displaying a list of tweets. The search is performed using a command and a service to get data from a remote location. The result is displayed in the DOM with the soma-template plugin.</p>
			</li>
			<li>
				<a href="../demos/todo" target="_blank">Todo app</a>
				<p>Demo managing a list to todo items that can be added, removed, set as completed, and stored in the local storage. The application contains a model holding the data, a view using soma-template and a command to handle the different type of user events.</p>
			</li>
			<li>
				<a href="../demos/todo-light" target="_blank">Todo app light</a>
				<p>Same todo app demo with a much lighter code. There's no command and no model API. The view updates the set of data directly using the soma-template function calls capability.</p>
			</li>
			<li>
				<a href="../demos/todo-hash" target="_blank">Todo app light with router</a>
				<p>Another version of the todo app light, with routes to filter the completed and active todo items. Director.js has been used as a router.</p>
			</li>
			<li>
				<a href="../demos/sniply" target="_blank">Sniply</a>
				<p>A complex web app that manage a list of snippets that are saved both in the local storage and on a remote server. The application can sign to the Github API (oauth 2.0) and is composed of a config, commands, models, a service, several views and some utils methods.</p>
			</li>
			<li>
				<a href="../demos/orientation" target="_blank">Orientation plugin</a>
				<p>Demo using a custom mobile plugin that dispatches events on a device orientation change (portrait and landscape).</p>
			</li>
			<li>
				<a href="../demos/router" target="_blank">Router with Director</a>
				<p>Demo using the recommended router library: <a href="https://github.com/flatiron/director" target="_blank">Director.js</a>.</p>
			</li>
			<li>
				<a href="http://somajs-nodejs-demo.eu01.aws.af.cm/node.js" target="_blank">Node.js</a>
				<p>Demo creating a server (express), commands, templates and models to get started with soma.js on node.js.</p>
			</li>
		</ul>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Tools</h1>
			<a class="anchor" name="tools"></a>
		</div>

		<p>soma.js is very lightweight and some tools might be needed to performed some actions, such as handling routes in a one-page application, making DOM manipulations or making ajax requests.</p>
		<p>Developers are free to use the libraries they like but here are some recommended libraries that are very efficient and well-tested.</p>

		<p><h4>Router</h4></p>

		<ul>
			<li><a href="https://github.com/flatiron/director" target="_blank">Director</a></li>
		</ul>

		<p><h4>Ajax requests</h4></p>

		<ul>
			<li><a href="https://github.com/ded/reqwest" target="_blank">Reqwest</a></li>
			<li><a href="http://api.jquery.com/jQuery.ajax/" target="_blank">jQuery</a></li>
		</ul>

		<p><h4>DOM manipulation</h4></p>

		<ul>
			<li><a href="http://soundstep.github.io/soma-template/" target="_blank">soma-template</a> (plugin)</li>
			<li><a href="http://handlebarsjs.com/" target="_blank">Handlebars</a></li>
		</ul>

		<p><h4>DOM selector</h4></p>

		<ul>
			<li><a href="https://github.com/ded/qwery" target="_blank">Qwery</a></li>
			<li><a href="http://zeptojs.com/" target="_blank">Zepto</a> (mobile)</li>
			<li><a href="http://jquery.com/" target="_blank">jQuery</a></li>
		</ul>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section>

		<div class="title">
			<h1>Tests</h1>
			<a class="anchor" name="tests"></a>
		</div>

		<p>soma.js, as well its internal libraries (infuse.js, soma-events and soma-template), are all fully tested. There is no such a thing as a bug-free library, if something does not work as intended, Github is the best place to report it.</p>

		<ul>
			<li><a href="../tests" target="_blank">soma.js tests</a></li>
			<li><a href="http://soundstep.github.io/soma-template/tests/" target="_blank">soma-template tests</a> (<a href="http://soundstep.github.io/soma-template/tests/internal.html" target="_blank">internal tests</a>)</li>
			<li><a href="https://github.com/soundstep/soma-events/tree/master/tests" target="_blank">soma-events tests</a></li>
			<li><a href="https://github.com/soundstep/infuse.js/tree/master/tests" target="_blank">infuse.js tests</a></li>
		</ul>

		<div class="back"><a href="#">top</a></div>

	</section>

	<section class="last">

		<div class="title">
			<h1>Browser support</h1>
			<a class="anchor" name="browser-support"></a>
		</div>

		<p>soma.js and its internal libraries (infuse.js, soma-events and soma-template) support all browsers and should work anywhere, with the exception of Internet Explorer 6.</p>

		<div class="back"><a href="#">top</a></div>

	</section>


</div>

<script src="assets/js/libs/jquery-1.8.2.min.js"></script>
<script src="assets/js/libs/modernizr.js"></script>
<script src="assets/js/libs/scale.fix.js"></script>
<script src="assets/js/app.js"></script>

</body>
</html>