(function(){soma={};soma.core={};soma.core.controller={};soma.core.model={};soma.core.view={};soma.core.wire={};soma.core.mediator={};function c(){}Function.instantiate=function(g,i){c.prototype=g.prototype;var h=new c(),e=g.apply(h,i);return e||h};Function.implement({instantiate:function(e){return Function.instantiate(this,e)}});var b=new Class({dispatchEvent:function(){this.instance.dispatchEvent.apply(this.instance,arguments)},addEventListener:function(){this.instance.addEventListener.apply(this.instance,arguments)},removeEventListener:function(){this.instance.removeEventListener.apply(this.instance,arguments)},hasCommand:function(e){return this.instance.hasCommand(e)},getCommand:function(e){return this.instance.getCommand(e)},getCommands:function(){return this.instance.getCommands()},addCommand:function(f,e){this.instance.controller.addCommand(f,e)},removeCommand:function(e){this.instance.controller.removeCommand(e)},hasWire:function(e){return this.instance.hasWire(e)},getWire:function(e){return this.instance.getWire(e)},addWire:function(f,e){return this.instance.addWire(f,e)},removeWire:function(e){this.instance.removeWire(e)},hasModel:function(e){return this.instance.hasModel(e)},getModel:function(e){return this.instance.getModel(e)},getSequencer:function(e){return !!this.instance.controller?this.instance.controller.getSequencer(e):null},stopSequencerWithEvent:function(e){return !!this.instance.controller?this.instance.controller.stopSequencerWithEvent(e):null},stopSequencer:function(e){if(this.instance.controller){return this.instance.controller.stopSequencer(e)}},stopAllSequencers:function(){if(this.instance.controller){this.instance.controller.stopAllSequencers()}},isPartOfASequence:function(e){return !!this.instance.controller?this.instance.controller.isPartOfASequence(e):false},getLastSequencer:function(){return !!this.instance.controller?this.instance.controller.getLastSequencer():null},getRunningSequencers:function(){return !!this.instance.controller?this.instance.controller.getRunningSequencers():null},addModel:function(e,f){return this.instance.addModel(e,f)},removeModel:function(e){this.instance.removeModel(e)},hasView:function(e){return this.instance.hasView(e)},getView:function(e){return this.instance.getView(e)},addView:function(f,e){return this.instance.addView(f,e)},removeView:function(e){this.instance.removeView(e)}});var d={blackList:["initialize","parent","$constructor","addEventListener","removeEventListener"],_somaAutobind:function(){if(this.wasAutoBound){return}var h=this;var f=h.AutoBindPattern;var g="([lL]istener|[hH]andler)$";if(!f){f=g}else{f=g+"|"+f}for(var e in h){if(typeof h[e]=="function"){if(this._autobindIsBlacklisted(e)){continue}if(!e.match(f)){continue}h[e]=h[e].bind(h)}}},_autobindIsBlacklisted:function(e){var g=this.blackList;for(var f=0;f<g.length;f++){if(g[f]==e){return true}}return false}};soma.core.AutoBind=new Class(d);soma.core.controller.Command=new Class({Implements:b,instance:null,registerInstance:function(e){this.instance=e},execute:function(f){throw new Error('Command.execute has to be implemented for "'+f+'"')}});var a=new Class({event:null,sequenceId:null,initialize:function(e){this.event=e}});soma.core.controller.SequenceCommand=new Class({Extends:soma.core.controller.Command,Implements:b,commands:null,currentCommand:null,id:null,initialize:function(e){if(e==null){throw new Error("SequenceCommand Children expect an unique id as constructor arg")}this.commands=[];this.id=e},registerInstance:function(e){this.instance=e;this.initializeSubCommands()},initializeSubCommands:function(){throw new Error("Subclasses of SequenceCommand must implement initializeSubCommands()")},addSubCommand:function(e){var f=new a(e);this.commands.push(f);this.instance.controller.registerSequencedCommand(this,f)},execute:function(e){if(this.commands==null||this.commands.length===0){return}this.currentCommand=this.commands.shift();if(this.hasCommand(this.currentCommand.event.type)){this.dispatchEvent(this.currentCommand.event)}},executeNextCommand:function(){if(this.commands==null){return}this.instance.controller.unregisterSequencedCommand(this,this.currentCommand.event.type);if(this.commands.length>0){this.execute(this.commands[0].event)}else{this.commands=null;this.currentCommand=null}},getLength:function(){if(this.commands==null){return -1}return this.commands.length},stop:function(){this.commands=null;this.commands=null;this.currentCommand=null;return this.instance.controller.unregisterSequencer(this)},getCurrentCommand:function(){return this.currentCommand},getCommands:function(){return this.commands}});soma.core.controller.ParallelCommand=new Class({Extends:soma.core.controller.Command,Implements:b,commands:null,initialize:function(){this.commands=[]},registerInstance:function(e){this.instance=e;this.initializeSubCommands()},initializeSubCommands:function(){throw new Error("Subclasses of ParallelCommand must implement initializeSubCommands()")},addSubCommand:function(f){this.commands.push(f)},execute:function(){while(this.commands.length>0){var e=this.commands.shift();if(this.hasCommand(e.type)){this.dispatchEvent(e)}}this.commands=null},getLength:function(){return this.commands!=null?this.commands.length:-1},getCommands:function(){return this.commands}});soma.core.wire.Wire=new Class({name:null,Implements:[b,soma.core.AutoBind],instance:null,initialize:function(e){if(e!=null){this.name=e}},registerInstance:function(e){this.instance=e},init:function(){},dispose:function(){},getName:function(){return this.name},setName:function(e){this.name=e}});soma.core.Controller=(function(){var k=null;var i=null;var e=null;var j=null;var h=null;var f=null;var g=null;return new Class({Implements:soma.IDisposable,instance:null,initialize:function(l){this.instance=l;e={};h={};j={};k=this.instanceHandler.bind(this);i=this.domTreeHandler.bind(this)},addInterceptor:function(l){if(!soma.core){throw new Error("soma package has been overwritten by local variable")}this.instance.body.addEventListener(l,i,true);this.instance.addEventListener(l,k,Number.NEGATIVE_INFINITY)},removeInterceptor:function(l){this.instance.body.removeEventListener(l,i,true);this.instance.removeEventListener(l,k)},executeCommand:function(m){var l=m.type;if(this.hasCommand(l)){var n=soma.createClassInstance(e[l]);n.registerInstance(this.instance);n.execute(m)}},registerSequencedCommand:function(l,n){if(!(n instanceof a)){throw new Error("capsulate sequence commands in SequenceCommandProxy objects!")}var m=h;if(m[l.id]==null||j[l.id]==null){g=l;m[l.id]=[];j[l.id]=l}n.sequenceId=l.id;m[l.id].push(n)},unregisterSequencedCommand:function(m,o){if(typeof o!="string"){throw new Error("Controller::unregisterSequencedCommand() expects commandName to be of type String, given:"+o)}var p=h;if(p[m.id]!=null&&p[m.id]!=undefined){var l=p[m.id].length;for(var n=0;n<l;n++){if(p[m.id][n].event.type==o){p[m.id][n]=null;p[m.id].splice(n,1);if(p[m.id].length==0){p[m.id]=null;delete p[m.id]}break}}}},unregisterSequencer:function(m){var o=j;if(o[m.id]!=null&&o[m.id]!=undefined){o[m.id]=null;delete o[m.id];o=h;if(o[m.id]!=null){var l=o[m.id].length;for(var n=0;n<l;n++){o[m.id][n]=null}o[m.id]=null;delete o[m.id];return true}}return false},hasCommand:function(l){return e[l]!=null},getCommand:function(l){if(this.hasCommand(l)){return e[l]}return null},getCommands:function(){var m=[];var l=e;for(var n in l){m.push(n)}return m},addCommand:function(l,m){if(this.hasCommand(l)){throw new Error("Error in "+this+' Command "'+l+'" already registered.')}e[l]=m;this.addInterceptor(l)},removeCommand:function(l){if(!this.hasCommand(l)){return}e[l]=null;delete e[l];this.removeInterceptor(l)},getSequencer:function(q){var o=h;for(var p in o){var l=o[p].length;for(var n=0;n<l;n++){if(o[p][n]&&o[p][n].event.type===q.type){var m=j[o[p][n].sequenceId];return !!m?m:null}}}return null},stopSequencerWithEvent:function(p){var n=h;for(var o in n){var l=n[o].length;for(var m=0;m<l;m++){if(n[o][m].event.type===p.type){try{j[n[o][m].sequenceId].stop()}catch(q){return false}return true}}}return false},stopSequencer:function(l){if(l==null){return false}l.stop();return true},stopAllSequencers:function(){var m=j;var o=h;for(var n in m){if(o[n]==null){continue}var l=o[n].length;o[n]=null;delete o[n];m[n].stop();m[n]=null;delete m[n]}},isPartOfASequence:function(l){return(this.getSequencer(l)!=null)},getRunningSequencers:function(){var l=[];var m=j;for(var n in m){l.push(m[n])}return l},getLastSequencer:function(){return g},dispose:function(){for(var m in e){this.removeCommand(m)}for(var l in j){j[l]=null;delete j[l]}e=null;j=null;f=null;g=null},domTreeHandler:function(m){if(m.bubbles&&this.hasCommand(m.type)&&!m.isCloned){m.stopPropagation();var l=m.clone();f=l;this.instance.dispatchEvent(l);if(!l.isDefaultPrevented()){this.executeCommand(m)}f=null}},instanceHandler:function(l){if(l.bubbles&&this.hasCommand(l.type)){if(f!=l){if(!l.isDefaultPrevented()){this.executeCommand(l)}}}f=null}})})();soma.core.view.SomaViews=(function(){var e=null;return new Class({Implements:soma.IDisposable,autoBound:false,initialize:function(){e={}},hasView:function(f){return e[f]!=null},addView:function(g,f){if(this.hasView(g)){throw new Error('View "'+g+'" already exists')}if(!this.autoBound){soma.View.implement(d);this.autoBound=true}if(f.autobind){f._somaAutobind()}e[g]=f;if(f.init!=null){f.init()}return f},getView:function(f){if(this.hasView(f)){return e[f]}return null},getViews:function(){var g={};for(var f in e){g[f]=e[f]}return g},removeView:function(f){if(!this.hasView(f)){return}if(e[f]["dispose"]!=null){e[f].dispose()}e[f]=null;delete e[f]},dispose:function(){for(var f in e){this.removeView(f)}e=null}})})()})();soma.createClassInstance=function(c,e){if(c.$constructor!=Class){c=new Class(new c())}if(arguments.length==1){return new c()}var b=[];for(var d=1;d<arguments.length;d++){b.push(arguments[d])}return c.instantiate(b)};soma.EventDispatcher=(function(){var a=[];return new Class({initialize:function(){a=[]},addEventListener:function(c,d,b){if(!a||!c||!d){return}if(isNaN(b)){b=0}a.push({type:c,listener:d,priority:b})},removeEventListener:function(d,f){if(!a||!d||!f){return}var c=0;var b=a.length;for(;c<b;++c){var e=a[c];if(e.type==d&&e.listener==f){a.splice(c,1);return}}return false},hasEventListener:function(d){if(!a||!d){return false}var c=0;var b=a.length;for(;c<b;++c){var e=a[c];if(e.type==d){return true}}return false},dispatchEvent:function(d){if(!a||!d){return}var c=[];var b;for(b=0;b<a.length;b++){var e=a[b];if(e.type==d.type){c.push(e)}}c.sort(function(g,f){return f.priority-g.priority});for(b=0;b<c.length;b++){c[b].listener.apply(d.currentTarget,[d])}},toString:function(){return"[Class soma.EventDispatcher]"},dispose:function(){a=null}})})();soma.core.Application=new Class({Extends:soma.EventDispatcher,Implements:soma.IDisposable,body:null,models:null,controller:null,wires:null,views:null,initialize:function(){this.body=document.body;if(!this.body){throw new Error("SomaCore requires body of type Element")}this.controller=new soma.core.Controller(this);this.models=new soma.core.model.SomaModels(this);this.wires=new soma.core.wire.SomaWires(this);this.views=new soma.core.view.SomaViews();this.init();this.registerModels();this.registerViews();this.registerCommands();this.registerWires();this.start()},hasCommand:function(a){return(!this.controller)?false:this.controller.hasCommand(a)},getCommand:function(a){return(!this.controller)?null:this.controller.getCommand(a)},getCommands:function(){return(!this.controller)?null:this.controller.getCommands()},addCommand:function(a,b){this.controller.addCommand(a,b)},removeCommand:function(a){this.controller.removeCommand(a)},hasWire:function(a){return(!this.wires)?false:this.wires.hasWire(a)},getWire:function(a){return(!this.wires)?null:this.wires.getWire(a)},getWires:function(){return(!this.wires)?null:this.wires.getWires()},addWire:function(b,a){return this.wires.addWire(b,a)},removeWire:function(a){this.wires.removeWire(a)},getModels:function(){return(!this.models)?null:this.models.getModels()},hasModel:function(a){return(!this.models)?false:this.models.hasModel(a)},getModel:function(a){return(!this.models)?null:this.models.getModel(a)},addModel:function(a,b){return this.models.addModel(a,b)},removeModel:function(a){this.models.removeModel(a)},hasView:function(a){return(!this.views)?false:this.views.hasView(a)},getView:function(a){return(!this.views)?null:this.views.getView(a)},getViews:function(){return(!this.views)?null:this.views.getViews()},addView:function(b,a){return this.views.addView(b,a)},removeView:function(a){this.views.removeView(a)},registerModels:function(){},registerCommands:function(){},registerViews:function(){},registerWires:function(){},getSequencers:function(){return !!this.controller?this.controller.getSequencers():null},getSequencer:function(a){return !!this.controller?this.controller.getSequencer(a):null},isPartOfASequence:function(a){return(this.getSequencer(a)!=null)},stopSequencerWithEvent:function(a){return !!this.controller?this.controller.stopSequencerWithEvent(a):false},stopSequencer:function(a){return !!this.controller?this.controller.stopSequencer(a):false},stopAllSequencers:function(){if(this.controller){this.controller.stopAllSequencers()}},getRunningSequencers:function(){return !!this.controller?this.controller.getRunningSequencers():null},getLastSequencer:function(){return !!this.controller?this.controller.getLastSequencer():null},dispose:function(){if(this.models){this.models.dispose();this.models=null}if(this.views){this.views.dispose();this.views=null}if(this.controller){this.controller.dispose();this.controller=null}if(this.wires){this.wires.dispose();this.wires=null}if(this.mediators){this.mediators.dispose();this.mediators=null}this.body=null},init:function(){},start:function(){}});soma.core.model.SomaModels=(function(){var a=null;return new Class({Implements:soma.IDisposable,instance:null,initialize:function(b){this.instance=b;a={}},hasModel:function(b){return a[b]!=null},getModel:function(b){if(this.hasModel(b)){return a[b]}return null},getModels:function(){var d={};var c=a;for(var b in c){d[b]=c[b]}return d},addModel:function(b,c){if(this.hasModel(b)){throw new Error('Model "'+b+'" already exists')}a[b]=c;if(!c.dispatcher){c.dispatcher=this.instance}c.init();return c},removeModel:function(b){if(!this.hasModel(b)){return}a[b].dispose();a[b]=null;delete a[b]},dispose:function(){for(var b in this.models){this.removeModel(b)}a=null}})})();soma.core.model.Model=new Class({name:null,data:null,dispatcher:null,initialize:function(a,c,b){this.data=c;this.dispatcher=b;if(a!=null){this.name=a}},init:function(){},dispose:function(){},dispatchEvent:function(){if(this.dispatcher){this.dispatcher.dispatchEvent.apply(this.dispatcher,arguments)}},addEventListener:function(){if(this.dispatcher){this.dispatcher.addEventListener.apply(this.dispatcher,arguments)}},removeEventListener:function(){if(this.dispatcher){this.dispatcher.addEventListener.apply(this.dispatcher,arguments)}},getName:function(){return this.name},setName:function(a){this.name=a}});soma.View=new Class({domElement:null,initialize:function(b){var a;if(b!=undefined){if(b instanceof Element){a=b}else{throw Error("domElement has to be a DOM-ELement")}}else{a=document.body}this.domElement=a},dispatchEvent:function(a){this.domElement.dispatchEvent(a)},addEventListener:function(){this.domElement.addEventListener.apply(this.domElement,arguments)},removeEventListener:function(){this.domElement.removeEventListener.apply(this.domElement,arguments)}});soma.core.wire.SomaWires=(function(){var a=null;return new Class({Implements:soma.IDisposable,instance:null,initialize:function(b){this.instance=b;a={}},hasWire:function(b){return a[b]!=null},addWire:function(c,b){if(this.hasWire(c)){throw new Error('Wire "'+c+'" already exists')}if(b.autobind){b._somaAutobind()}a[c]=b;b.registerInstance(this.instance);b.init();return b},getWire:function(b){if(this.hasWire(b)){return a[b]}return null},getWires:function(){var c={};for(var b in a){c[b]=a[b]}return c},removeWire:function(b){if(!this.hasWire(b)){return}a[b].dispose();a[b]=null;delete a[b]},dispose:function(){for(var b in a){this.removeWire(b)}a=null}})})();soma.core.mediator.Mediator=new Class({Extends:soma.core.wire.Wire,Implements:soma.IDisposable,viewComponent:null,initialize:function(a){this.viewComponent=a;this.parent()},dispose:function(){this.viewComponent=null;this.parent()}});soma.Event=new Class({initialize:function(d,f,b,a){var g=document.createEvent("Event");g.initEvent(d,b!==undefined?b:true,a!==undefined?a:false);g.cancelable=a!==undefined?a:false;if(f){for(var c in f){g[c]=f[c]}g.data=f}g.clone=this.clone.bind(g);g.isDefaultPrevented=this.isDefaultPrevented;return g},clone:function(){var b=document.createEvent("Event");b.initEvent(this.type,this.bubbles,this.cancelable);var c=this.data;for(var a in c){b[a]=c[a]}b.data=c;b.isCloned=true;b.clone=this.clone;b.isDefaultPrevented=this.isDefaultPrevented;return b},isDefaultPrevented:function(){if(this.getDefaultPrevented){return this.getDefaultPrevented()}else{return this.defaultPrevented}}});soma.core.IResponder=new Class({fault:function(a){},result:function(a){}});soma.core.IDisposable=new Class({dispose:function(){}});